function t(t){return t&&t.__esModule?t.default:t}var e,a;a=function(t,e,a,n){var r=t[0],o=t[1],s=!1;void 0===a&&(a=0),void 0===n&&(n=e.length);for(var c=(n-a)/2,i=0,l=c-1;i<c;l=i++){var d=e[a+2*i+0],u=e[a+2*i+1],p=e[a+2*l+0],f=e[a+2*l+1];u>o!=f>o&&r<(p-d)*(o-u)/(f-u)+d&&(s=!s)}return s};var n;async function r(){return await d3.json("montreal.json")}async function o(){return await d3.json("reseau_cyclable.geojson")}function s(a,n,r){let o="";return r.forEach((r=>{t(e)([a,n],r.geometry.coordinates[0][0])&&(o=r.properties.NOM)})),o}function c(t){return d3.geoPath().projection(t)}function i(t,e,a){const n=a([t,e]);return{x:n[0],y:n[1]}}function l(t,e=""){return e&&(t=t.map((t=>t[e]))),t.reduce(((t,e)=>t+(isNaN(e)?0:e)),0)}function d(t,e,a){return t.reduce(((t,n)=>(t[n[e]]=(t[n[e]]||0)+(isNaN(n[a])?0:n[a]),t)),{})}async function u(t){const e={};return await Promise.all(t.map((async t=>{e[t]=await d3.csv("comptage_velo_"+t+".csv")}))),e}async function p(){return await d3.csv("localisation_des_compteurs_velo.csv")}function f(t,e,a){const n={};return a.forEach((a=>{const r=e[a];n[a]={};const o=Object.keys(r[0]).filter((t=>"Date"!==t&&""!==t));o.forEach((e=>{const r=t.find((t=>e.includes("compteur")?e.includes(t.ID):t.Nom===e));n[a][r.Nom]={name:r.Nom,longitude:r.Longitude,latitude:r.Latitude,counts:[]}})),r.forEach((e=>{let r,s="00:00";Object.entries(e).map((([t,e])=>{if("Date"===t){const t=e.split(" ");r=t[0],t.length>1&&(s=t[1])}return[t,e]})).filter((([t])=>o.includes(t))).forEach((([e,o])=>{parseInt(a)>2018&&(e=t.find((t=>e.includes(t.ID))).Nom),n[a][e].counts.push({date:r,time:s,count:parseInt(o)})}))}))})),n}function m(t,e,a){const n={};return Object.entries(t).forEach((([t,r])=>{n[t]=Object.entries(r).map((([t,n])=>({name:t,neighborhood:s(n.longitude,n.latitude,e),counts:l(n.counts,"count"),...i(n.longitude,n.latitude,a)})))})),n}function g(t,e){const a={};return Object.entries(t).forEach((([t,n])=>{let r;a[t]={},Object.entries(n).forEach((([n,o])=>{let c=[];c=o.counts.length>366?Object.values(d(o.counts,"date","count")):o.counts.map((t=>isNaN(t.count)?0:t.count)),r?c.map(((t,e)=>{r[e]+=t})):r=c,a[t][n]={name:n,neighborhood:s(o.longitude,o.latitude,e),counts:c.map(((t,e)=>({index:e,value:t})))}}));const o=Object.keys(n).length;a[t].Average={name:"All",neighborhood:"",counts:r.map(((t,e)=>({index:e,value:Math.round(t/o)})))}})),a}function h(t){const e={};return Object.entries(t).forEach((([t,a])=>{if(parseInt(t)<2019)return;let n;e[t]={},Object.entries(a).forEach((([a,r])=>{let o=Object.values(d(r.counts,"time","count"));n?o.map(((t,e)=>{n[e]+=t})):n=o,e[t][a]={name:a,counts:o.map(((t,e)=>({index:e,value:t})))}}));const r=Object.keys(a).length;e[t].Average={name:"All",counts:n.map(((t,e)=>({index:e,value:Math.round(t/r)})))}})),e}function v(t){const e={};return Object.entries(t).forEach((([t,a])=>{let n=0;Object.entries(a).forEach((([a,r])=>{const o={year:t,counts:l(r.counts,"count")};n+=o.counts,e[a]?e[a].push(o):e[a]=[o]}));const r={year:t,counts:Math.round(n/Object.keys(a).length)};e.Average?e.Average.push(r):e.Average=[r]})),e}function x(t,e){d3.select("#map-base-g").selectAll("path").data(t).enter().append("path").attr("d",e).attr("fill","#d8dbe3").attr("stroke","#ffffff").attr("stroke-width",1)}function y(t,e){d3.select("#map-lanes-g").selectAll("path").data(t).enter().append("path").attr("d",e).attr("fill","rgba(0,0,0,0)").attr("stroke","#0bb52d").attr("stroke-width",1.5)}function b(t,e){const a=function(t){const e=d3.max(t.map((t=>t.counts)));return d3.scaleLinear().domain([0,e]).range([4,10])}(t);d3.select("#map-circles-g").selectAll("circle").remove(),d3.select("#map-circles-g").selectAll("circle").data(t).enter().append("circle").attr("class","circle").attr("r",(t=>a(t.counts))).attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("fill","rgb(18, 81, 153)").attr("stroke","#ffffff").attr("stroke-width",1).on("click",e)}function w(t){return d3.select("#dropdown").selectAll("myOptions").data(t).enter().append("option").text((function(t){return t})).attr("value",(function(t){return t})),t[0]}function j(t,e,a,n){const r=d3.select("#line-svg").attr("width",t+80).attr("height",e+80);r.selectAll("g").remove(),function(t,e,a,n,r){t.append("g").append("text").attr("class","axis-label").text("Jours de l'année").attr("x",e/2+30).attr("y",a),t.append("g").append("text").attr("class","axis-label").text("Comptes").attr("x",10).attr("y",a/2).attr("transform","rotate(-90)");const o=t.append("g").append("text").attr("class","graph-title").attr("x",e/2+30).attr("y",15);n?o.text(n+" - "+r):o.text("Moyenne de tous les compteurs")}(r,t+80,e+70,n&&n.name,n&&n.neighborhood);const o=r.append("g").attr("width",t+30).attr("height",e+20).attr("transform","translate(10, 30)"),s=function(t,e){return d3.scaleLinear().domain([0,e]).range([0,t])}(t,a.counts.length),c=function(t,e){return d3.scaleLinear().domain([0,d3.max(e)]).range([t,0]).nice()}(e,[...a.counts.map((t=>t.value)),...n?n.counts.map((t=>t.value)):[]]);!function(t,e,a,n){const r=d3.axisBottom(d3.scaleTime().domain([new Date(2e3,1,0),new Date(2e3,12,1)]).range([0,e]).nice()).ticks(12).tickFormat(d3.timeFormat("%b"));t.append("g").attr("class","axis").attr("transform","translate(59,"+a+")").call(r),t.attr("class","axis").append("g").attr("transform","translate(59,0)").call(d3.axisLeft(n))}(o,t,e,c);const i=o.append("g").attr("width",t).attr("height",e).attr("transform","translate(60, 0)");i.append("path").datum(a.counts).attr("fill","rgba(0, 0, 0, 0)").attr("stroke","#9a9a9a").attr("stroke-width",1).attr("d",d3.line().x((function(t){return s(t.index)})).y((function(t){return c(t.value)}))),n&&i.append("path").datum(n.counts).attr("fill","rgba(0, 0, 0, 0)").attr("stroke","rgba(18, 81, 153, 1)").attr("stroke-width",1).attr("d",d3.line().x((function(t){return s(t.index)})).y((function(t){return c(t.value)})))}function k(t,e){!function(t,e){t.append("text").attr("class","graph-title").attr("x",e/2+30).attr("y",15).text("Comptes pendant la journée")}(d3.select("#area-svg").attr("width",t+80).attr("height",e+80),t)}function A(t,e,a,n){const r=d3.select("#area-svg");r.selectAll("g").remove(),function(t,e,a){t.append("g").append("text").attr("class","axis-label").text("Heures de la journée").attr("x",e/2+30).attr("y",a),t.append("g").append("text").attr("class","axis-label").text("Comptes").attr("x",10).attr("y",a/2).attr("transform","rotate(-90)")}(r,t+80,e+70,n&&n.name);const o=r.append("g").attr("width",t+30).attr("height",e+20).attr("transform","translate(10, 30)"),s=function(t){return d3.scaleLinear().domain([0,96]).range([0,t])}(t),c=function(t,e){return d3.scaleLinear().domain([0,d3.max(e)]).range([t,0]).nice()}(e,[...a.counts.map((t=>t.value)),...n?n.counts.map((t=>t.value)):[]]);!function(t,e,a,n){const r=d3.axisBottom(d3.scaleTime().range([0,e-7]).nice()).ticks(20).tickFormat(d3.timeFormat("%H:%M"));t.append("g").attr("class","axis").attr("transform","translate(59,"+a+")").call(r),t.attr("class","axis").append("g").attr("transform","translate(59,0)").call(d3.axisLeft(n))}(o,t,e,c);const i=o.append("g").attr("width",t).attr("height",e).attr("transform","translate(60, 0)");i.append("path").datum(a.counts).attr("fill","#c9c9c9").attr("stroke","#9a9a9a").attr("stroke-width",1).attr("d",d3.area().x((function(t){return s(t.index)})).y0(e).y1((function(t){return c(t.value)}))),n&&i.append("path").datum(n.counts).attr("fill","rgba(77, 149, 232, 0.5)").attr("stroke","rgba(18, 81, 153, 0.5)").attr("stroke-width",1).attr("d",d3.area().x((function(t){return s(t.index)})).y0(e).y1((function(t){return c(t.value)})))}function O(t){const e=d3.select("#area-svg");e.selectAll("g").remove(),e.append("g").append("text").attr("class","empty-label").text("Cette donnée n'est pas disponible pour l'année choisie.").attr("x",t/2+30).attr("y",80)}(e=function(t,e,r,o){return e.length>0&&Array.isArray(e[0])?n(t,e,r,o):a(t,e,r,o)}).nested=n=function(t,e,a,n){var r=t[0],o=t[1],s=!1;void 0===a&&(a=0),void 0===n&&(n=e.length);for(var c=n-a,i=0,l=c-1;i<c;l=i++){var d=e[i+a][0],u=e[i+a][1],p=e[l+a][0],f=e[l+a][1];u>o!=f>o&&r<(p-d)*(o-u)/(f-u)+d&&(s=!s)}return s},e.flat=a;d3.scaleBand().padding(.15),d3.scaleBand().padding([.015]),d3.scaleLinear();async function N(){const t=await d3.json("https://cdn.jsdelivr.net/npm/d3-time-format@3/locale/fr-CA.json");t.shortMonths=t.shortMonths.map((t=>t.slice(0,1).toUpperCase()+t.slice(1))),t.months=t.months.map((t=>t.slice(0,1).toUpperCase()+t.slice(1))),d3.timeFormatDefaultLocale(t)}!async function(){N();const t=800,e=625,a=800,n=350,s=400,i=250,l=[2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021],d=await r(),E=await o(),L=await p(),M=await u(l);var _,C;_=t,C=e,d3.select("#map-svg").attr("width",_).attr("height",C).append("g").attr("id","map-base-g").attr("width",_).attr("height",C).select((function(){return this.parentNode})).append("g").attr("id","map-lanes-g").attr("width",_).attr("height",C).select((function(){return this.parentNode})).append("g").attr("id","map-circles-g").attr("width",_).attr("height",C),k(a,n),d3.select("#map-svg").append("g").attr("id","line-svg");const D=d3.geoMercator().center([-73.708879,45.579611]).scale(7e4),F=c(D);x(d,F),y(E,F);const I=f(L,M,l),B=m(I,d,D),H=g(I,d),P=h(I);v(I);function T(t,e){j(s,i,H[t].Average,H[t][e]),t>2018?A(a,n,P[t].Average,P[t][e]):O()}function U(t){var e;b(B[t],(e=T,t=>{const a=d3.select("#dropdown").property("value"),n=t.name;e(a,n)})),j(s,i,H[t].Average),t>2018?A(a,n,P[t].Average):O(a)}const z=w(l);var J;J=U,d3.select("#dropdown").on("change",(()=>{const t=d3.select("#dropdown").property("value");J(t)})),d3.select("#viz-container").style("visibility","visible"),d3.select("#spinner").style("display","none"),U(z)}(d3);
//# sourceMappingURL=index.3e97f512.js.map
