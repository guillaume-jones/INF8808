{"mappings":"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","sources":["node_modules/point-in-polygon/flat.js","src/scripts/geography.js","src/scripts/preprocess.js","src/scripts/mapViz.js","src/scripts/dropdown.js","src/scripts/lineChart.js","src/scripts/areaChart.js","node_modules/point-in-polygon/index.js","node_modules/point-in-polygon/nested.js","src/scripts/barChartViz.js","src/scripts/changeLocale.js","src/index.js","src/scripts/clickHandlers.js","src/scripts/spinner.js"],"sourcesContent":["module.exports = function pointInPolygonFlat (point, vs, start, end) {\n    var x = point[0], y = point[1];\n    var inside = false;\n    if (start === undefined) start = 0;\n    if (end === undefined) end = vs.length;\n    var len = (end-start)/2;\n    for (var i = 0, j = len - 1; i < len; j = i++) {\n        var xi = vs[start+i*2+0], yi = vs[start+i*2+1];\n        var xj = vs[start+j*2+0], yj = vs[start+j*2+1];\n        var intersect = ((yi > y) !== (yj > y))\n            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n        if (intersect) inside = !inside;\n    }\n    return inside;\n};\n","import pointInPolygon from 'point-in-polygon';\r\n\r\n/** Gets the Montreal geographical data\r\n *\r\n * @returns {object[]} Montreal GEOJSON\r\n */\r\nexport async function getMontrealData() {\r\n  return await d3.json('montreal.json');\r\n}\r\n\r\n/** Gets the Montreal geographical data\r\n *\r\n * @returns {object[]} Montreal's bike path GEOJSON\r\n */\r\nexport async function getBikePaths() {\r\n  return await d3.json('reseau_cyclable.geojson');\r\n}\r\n\r\n/**\r\n * Determines the neighborhood based on coordinates\r\n *\r\n * @param lon Longitude of point (float)\r\n * @param lat Latitude of point (float)\r\n * @param montreal Pre-loaded JSON of Montreal data\r\n *\r\n * @returns {string} Neighborhood of point or empty if not found\r\n */\r\nexport function determineNeighborhood(lon, lat, montreal) {\r\n  let returnName = '';\r\n\r\n  montreal.forEach((feature) => {\r\n    if (pointInPolygon([lon, lat], feature.geometry.coordinates[0][0])) {\r\n      returnName = feature.properties.NOM;\r\n    }\r\n  });\r\n\r\n  return returnName;\r\n}\r\n\r\n/** Gets the map projection function\r\n *\r\n * @returns Projection function in Mercator for Montreal\r\n */\r\nexport function getProjection() {\r\n  return d3.geoMercator().center([-73.708879, 45.579611]).scale(70000);\r\n}\r\n\r\n/** Gets the path function\r\n *\r\n * @param projection Projection in Mercator for Montreal\r\n *\r\n * @returns Path function for Montreal\r\n */\r\nexport function getPath(projection) {\r\n  return d3.geoPath().projection(projection);\r\n}\r\n\r\n/** Gets the XY positions on the map viz for a given set of coordinates\r\n * @param {number} longitude Longitude to convert\r\n * @param {number} latitude Latitude to convert\r\n * @param projection Projection in Mercator for Montreal\r\n *\r\n * @returns {x: number, y: number}\r\n */\r\nexport function convertCoordinatesToXY(longitude, latitude, projection) {\r\n  const projected = projection([longitude, latitude]);\r\n  return {\r\n    x: projected[0],\r\n    y: projected[1],\r\n  };\r\n}\r\n","import { convertCoordinatesToXY, determineNeighborhood } from './geography';\r\n\r\nfunction sum(a, key = '') {\r\n  if (key) {\r\n    a = a.map((a) => a[key]);\r\n  }\r\n  return a.reduce((b, c) => b + (isNaN(c) ? 0 : c), 0);\r\n}\r\n\r\nfunction groupSum(a, key, key2) {\r\n  return a.reduce((b, c) => {\r\n    b[c[key]] = (b[c[key]] || 0) + (isNaN(c[key2]) ? 0 : c[key2]);\r\n    return b;\r\n  }, {});\r\n}\r\n\r\n/** Load counter CSVs\r\n *\r\n * @param {number[]} years Array of years to load\r\n *\r\n * @returns {object[]} Array of data by year\r\n */\r\nexport async function getCounterData(years) {\r\n  const counterData = {};\r\n  // Required due to asynchronous loop\r\n  await Promise.all(\r\n    years.map(async (year) => {\r\n      counterData[year] = await d3.csv('comptage_velo_' + year + '.csv');\r\n    }),\r\n  );\r\n\r\n  return counterData;\r\n}\r\n\r\n/** Load location CSV\r\n *\r\n * @returns {object} Location data\r\n */\r\nexport async function getLocationData() {\r\n  return await d3.csv('localisation_des_compteurs_velo.csv');\r\n}\r\n\r\n/** Convert location and counter data into usable dataset\r\n *\r\n * Filters out partial data\r\n * Harmonizes IDs and names\r\n * Organizes by year, counter name, date and time\r\n *\r\n * @param {object} locations Location data from CSV\r\n * @param {object[]} counters Counter data from CSV\r\n * @param {object} years Years of data loaded into counters\r\n *\r\n * @returns {object[]} The filtered and combined dataset\r\n */\r\nexport function createDataset(locations, counters, years) {\r\n  const dataset = {};\r\n\r\n  years.forEach((year) => {\r\n    const counterData = counters[year];\r\n    dataset[year] = {};\r\n\r\n    // Keeps only data columns\r\n    const acceptedCounters = Object.keys(counterData[0]).filter((name) => {\r\n      return name !== 'Date' && name !== '';\r\n    });\r\n\r\n    // Gets relevant data for each counter from location dataset\r\n    acceptedCounters.forEach((name) => {\r\n      const counter = locations.find((t) => {\r\n        if (name.includes('compteur')) {\r\n          // Finds via ID, for 2019-2021 datasets\r\n          return name.includes(t.ID);\r\n        } else {\r\n          // Finds via name, for 2009-2018 datasets\r\n          return t.Nom === name;\r\n        }\r\n      });\r\n\r\n      dataset[year][counter.Nom] = {\r\n        name: counter.Nom,\r\n        longitude: counter.Longitude,\r\n        latitude: counter.Latitude,\r\n        counts: [],\r\n      };\r\n    });\r\n\r\n    // Iterates through counterData to add counts to each counter\r\n    counterData.forEach((timestep) => {\r\n      let date = undefined;\r\n      let time = '00:00';\r\n\r\n      Object.entries(timestep)\r\n        .map(([key, value]) => {\r\n          if (key === 'Date') {\r\n            const dateTime = value.split(' ');\r\n            date = dateTime[0];\r\n            // Gets time as well for datasets after 2018\r\n            if (dateTime.length > 1) {\r\n              time = dateTime[1];\r\n            }\r\n          }\r\n          return [key, value];\r\n        })\r\n        .filter(([name]) => acceptedCounters.includes(name))\r\n        .forEach(([name, count]) => {\r\n          if (parseInt(year) > 2018) {\r\n            name = locations.find((t) => name.includes(t.ID)).Nom;\r\n          }\r\n          dataset[year][name].counts.push({\r\n            date: date,\r\n            time: time,\r\n            count: parseInt(count),\r\n          });\r\n        });\r\n    });\r\n  });\r\n\r\n  return dataset;\r\n}\r\n\r\n/** Generates data in format for map\r\n *\r\n * @param {object} dataset Dataset created by createDataset\r\n * @param montreal Pre-loaded JSON of Montreal data\r\n * @param projection Projection used for the map\r\n *\r\n * @returns {object} Data for Area chart\r\n */\r\nexport function createMapData(dataset, montreal, projection) {\r\n  const mapData = {};\r\n\r\n  Object.entries(dataset).forEach(([year, yearData]) => {\r\n    mapData[year] = Object.entries(yearData).map(([counter, counterData]) => {\r\n      return {\r\n        name: counter,\r\n        neighborhood: determineNeighborhood(\r\n          counterData.longitude,\r\n          counterData.latitude,\r\n          montreal,\r\n        ),\r\n        counts: sum(counterData.counts, 'count'),\r\n        ...convertCoordinatesToXY(\r\n          counterData.longitude,\r\n          counterData.latitude,\r\n          projection,\r\n        ),\r\n      };\r\n    });\r\n  });\r\n\r\n  return mapData;\r\n}\r\n\r\n/** Generates data in format for line chart\r\n *\r\n * @param {object} dataset Dataset created by createDataset\r\n * @param montreal Pre-loaded JSON of Montreal data\r\n */\r\nexport function createLineChartData(dataset, montreal) {\r\n  const lineChartData = {};\r\n\r\n  Object.entries(dataset).forEach(([year, yearData]) => {\r\n    lineChartData[year] = {};\r\n    let averageDayCounts;\r\n\r\n    // Sums counts across each day for each counter\r\n    // Also adds neighborhood\r\n    Object.entries(yearData).forEach(([counter, counterData]) => {\r\n      let newCounts = [];\r\n\r\n      // Years 2019-2021 need to group the data by day\r\n      if (counterData.counts.length > 366) {\r\n        newCounts = Object.values(\r\n          groupSum(counterData.counts, 'date', 'count'),\r\n        );\r\n      } else {\r\n        newCounts = counterData.counts.map((data) => {\r\n          return isNaN(data.count) ? 0 : data.count;\r\n        });\r\n      }\r\n\r\n      // Save this counter's data to averageDayCounts\r\n      if (!averageDayCounts) {\r\n        averageDayCounts = newCounts;\r\n      } else {\r\n        newCounts.map((count, i) => {\r\n          averageDayCounts[i] += count;\r\n        });\r\n      }\r\n\r\n      lineChartData[year][counter] = {\r\n        name: counter,\r\n        neighborhood: determineNeighborhood(\r\n          counterData.longitude,\r\n          counterData.latitude,\r\n          montreal,\r\n        ),\r\n        counts: newCounts.map((v, i) => {\r\n          return {\r\n            index: i,\r\n            value: v,\r\n          };\r\n        }),\r\n      };\r\n    });\r\n\r\n    const totalCounters = Object.keys(yearData).length;\r\n\r\n    lineChartData[year]['Average'] = {\r\n      name: 'All',\r\n      neighborhood: '',\r\n      counts: averageDayCounts.map((counts, i) => {\r\n        return { index: i, value: Math.round(counts / totalCounters) };\r\n      }),\r\n    };\r\n  });\r\n\r\n  return lineChartData;\r\n}\r\n\r\n/** Generates data in format for area chart\r\n *\r\n * @param {object} dataset Dataset created by createDataset\r\n *\r\n * @returns {object} Data for Area chart\r\n */\r\nexport function createAreaChartData(dataset) {\r\n  const areaChartData = {};\r\n\r\n  Object.entries(dataset).forEach(([year, yearData]) => {\r\n    // Time data not available for years before 2019\r\n    if (parseInt(year) < 2019) {\r\n      return;\r\n    }\r\n\r\n    areaChartData[year] = {};\r\n    let averageTimeCounts;\r\n\r\n    // Sums counts across each day for each counter\r\n    // Also adds neighborhood\r\n    Object.entries(yearData).forEach(([counter, counterData]) => {\r\n      let newCounts = Object.values(\r\n        groupSum(counterData.counts, 'time', 'count'),\r\n      );\r\n\r\n      // Save this counter's data to averageTimeCounts\r\n      if (!averageTimeCounts) {\r\n        averageTimeCounts = newCounts;\r\n      } else {\r\n        newCounts.map((count, i) => {\r\n          averageTimeCounts[i] += count;\r\n        });\r\n      }\r\n\r\n      areaChartData[year][counter] = {\r\n        name: counter,\r\n        counts: newCounts.map((v, i) => {\r\n          return {\r\n            index: i,\r\n            value: v,\r\n          };\r\n        }),\r\n      };\r\n    });\r\n\r\n    const totalCounters = Object.keys(yearData).length;\r\n\r\n    areaChartData[year]['Average'] = {\r\n      name: 'All',\r\n      counts: averageTimeCounts.map((counts, i) => {\r\n        return { index: i, value: Math.round(counts / totalCounters) };\r\n      }),\r\n    };\r\n  });\r\n\r\n  return areaChartData;\r\n}\r\n\r\n/** Generates data in format for bar chart\r\n *\r\n * @param {object} dataset Dataset created by createDataset\r\n */\r\nexport function createBarChartData(dataset) {\r\n  const barChartData = {};\r\n\r\n  Object.entries(dataset).forEach(([year, yearData]) => {\r\n    let allCounts = 0;\r\n\r\n    // Sums counts across entire year for each counter\r\n    Object.entries(yearData).forEach(([counter, counterData]) => {\r\n      const counterSum = {\r\n        year: year,\r\n        counts: sum(counterData.counts, 'count'),\r\n      };\r\n\r\n      allCounts += counterSum.counts;\r\n\r\n      barChartData[counter]\r\n        ? barChartData[counter].push(counterSum)\r\n        : (barChartData[counter] = [counterSum]);\r\n    });\r\n\r\n    // Adds average of all sensors for year for default view\r\n    const average = {\r\n      year: year,\r\n      counts: Math.round(allCounts / Object.keys(yearData).length),\r\n    };\r\n\r\n    barChartData['Average']\r\n      ? barChartData['Average'].push(average)\r\n      : (barChartData['Average'] = [average]);\r\n  });\r\n\r\n  return barChartData;\r\n}\r\n","/**\r\n * Adds SVG groups for the map base, bike paths and circles\r\n *\r\n * @param {number} width The width of the graph\r\n * @param {number} height The height of the graph\r\n */\r\nexport function generateMapGroups(width, height) {\r\n  d3.select('#map-svg')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .append('g')\r\n    .attr('id', 'map-base-g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .select(function () {\r\n      return this.parentNode;\r\n    })\r\n    .append('g')\r\n    .attr('id', 'map-lanes-g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .select(function () {\r\n      return this.parentNode;\r\n    })\r\n    .append('g')\r\n    .attr('id', 'map-circles-g')\r\n    .attr('width', width)\r\n    .attr('height', height);\r\n}\r\n\r\n/**\r\n * Draws the map base of Montreal.\r\n *\r\n * @param {object[]} data The data for the map base\r\n * @param {*} path The path associated with the current projection\r\n */\r\nexport function drawMapBackground(data, path) {\r\n  d3.select('#map-base-g')\r\n    .selectAll('path')\r\n    .data(data)\r\n    .enter()\r\n    .append('path')\r\n    .attr('d', path)\r\n    .attr('fill', '#d8dbe3')\r\n    .attr('stroke', '#ffffff')\r\n    .attr('stroke-width', 1);\r\n}\r\n\r\n/**\r\n * Draws the cycle lanes of Montreal\r\n *\r\n * @param {object[]} data The data for the cycle lanes\r\n * @param {*} path The path associated with the current projection\r\n */\r\nexport function drawBikePaths(data, path) {\r\n  d3.select('#map-lanes-g')\r\n    .selectAll('path')\r\n    .data(data)\r\n    .enter()\r\n    .append('path')\r\n    .attr('d', path)\r\n    .attr('fill', 'rgba(0,0,0,0)')\r\n    .attr('stroke', '#0bb52d')\r\n    .attr('stroke-width', 1.5);\r\n}\r\n\r\nfunction radiusScale(data) {\r\n  const maxCounts = d3.max(data.map((data) => data.counts));\r\n  return d3.scaleLinear().domain([0, maxCounts]).range([4, 10]);\r\n}\r\n\r\n/**\r\n * Draws the counter\r\n *\r\n * @param {object[]} data The data for the map\r\n * @param callback The callback to call on circle click\r\n */\r\nexport function drawCircles(data, callback) {\r\n  const scale = radiusScale(data);\r\n\r\n  d3.select('#map-circles-g').selectAll('circle').remove();\r\n\r\n  d3.select('#map-circles-g')\r\n    .selectAll('circle')\r\n    .data(data)\r\n    .enter()\r\n    .append('circle')\r\n    .attr('class', 'circle')\r\n    .attr('r', (d) => scale(d.counts))\r\n    .attr('cx', (d) => d.x)\r\n    .attr('cy', (d) => d.y)\r\n    .attr('fill', 'rgb(18, 81, 153)')\r\n    .attr('stroke', '#ffffff')\r\n    .attr('stroke-width', 1)\r\n    .on('click', callback);\r\n}\r\n","/**\r\n * Draws the dropdown menu to select the desired year\r\n *\r\n * @param {number} years The years to display\r\n * @param {number} width The width of the graph, used to place the button\r\n *\r\n * @returns Initial year in dropdown\r\n */\r\nexport function drawDropdown(years) {\r\n  d3.select('#dropdown')\r\n    .selectAll('myOptions')\r\n    .data(years)\r\n    .enter()\r\n    .append('option')\r\n    .text(function (d) {\r\n      return d;\r\n    })\r\n    .attr('value', function (d) {\r\n      return d;\r\n    });\r\n\r\n  return years[0];\r\n}\r\n","export function addLineGroup() {\r\n  d3.select('#map-svg').append('g').attr('id', 'line-svg');\r\n}\r\n\r\nfunction addLabels(g, width, height, name, neighborhood) {\r\n  // X label\r\n  g.append('g')\r\n    .append('text')\r\n    .attr('class', 'axis-label')\r\n    .text(\"Jours de l'année\")\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', height);\r\n  // Y label\r\n  g.append('g')\r\n    .append('text')\r\n    .attr('class', 'axis-label')\r\n    .text('Comptes')\r\n    .attr('x', 10)\r\n    .attr('y', height / 2)\r\n    .attr('transform', 'rotate(-90)');\r\n  // Title\r\n  const title = g\r\n    .append('g')\r\n    .append('text')\r\n    .attr('class', 'graph-title')\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', 15);\r\n  if (name) {\r\n    title.text(name + ' - ' + neighborhood);\r\n  } else {\r\n    title.text('Moyenne de tous les compteurs');\r\n  }\r\n}\r\n\r\nfunction generateXScale(width, days) {\r\n  return d3.scaleLinear().domain([0, days]).range([0, width]);\r\n}\r\n\r\nfunction generateYScale(height, counts) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain([0, d3.max(counts)])\r\n    .range([height, 0])\r\n    .nice();\r\n}\r\n\r\nfunction addAxes(g, width, height, yScale) {\r\n  // Create X axis with 24 hr time\r\n  const xAxis = d3\r\n    .axisBottom(\r\n      d3\r\n        .scaleTime()\r\n        .domain([new Date(2000, 1, 0), new Date(2000, 12, 1)])\r\n        .range([0, width])\r\n        .nice(),\r\n    )\r\n    .ticks(12)\r\n    .tickFormat(d3.timeFormat('%b'));\r\n\r\n  // Add axes, pixel-perfect positioning\r\n  g.append('g')\r\n    .attr('class', 'axis')\r\n    .attr('transform', 'translate(59,' + height + ')')\r\n    .call(xAxis);\r\n  g.attr('class', 'axis')\r\n    .append('g')\r\n    .attr('transform', 'translate(59,0)')\r\n    .call(d3.axisLeft(yScale));\r\n}\r\n\r\n/**\r\n * Draws the line chart\r\n *\r\n * @param {object[]} data The data for the map\r\n * @param callback The callback to call on circle click\r\n */\r\nexport function drawLineChart(width, height, averageData, counterData) {\r\n  const svg = d3\r\n    .select('#line-svg')\r\n    .attr('width', width + 80)\r\n    .attr('height', height + 80);\r\n\r\n  // Reset line chart svg\r\n  svg.selectAll('g').remove();\r\n\r\n  // Add labels\r\n  addLabels(\r\n    svg,\r\n    width + 80,\r\n    height + 70,\r\n    counterData && counterData.name,\r\n    counterData && counterData.neighborhood,\r\n  );\r\n\r\n  const outerG = svg\r\n    .append('g')\r\n    .attr('width', width + 30)\r\n    .attr('height', height + 20)\r\n    .attr('transform', 'translate(10, 30)');\r\n\r\n  // Generate scales\r\n  const xScale = generateXScale(width, averageData.counts.length);\r\n  const yScale = generateYScale(height, [\r\n    ...averageData.counts.map((v) => v.value),\r\n    ...(counterData ? counterData.counts.map((v) => v.value) : []),\r\n  ]);\r\n\r\n  // Add axes\r\n  addAxes(outerG, width, height, yScale);\r\n\r\n  const innerG = outerG\r\n    .append('g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .attr('transform', 'translate(60, 0)');\r\n\r\n  // Draw chart\r\n  innerG\r\n    .append('path')\r\n    .datum(averageData.counts)\r\n    .attr('fill', 'rgba(0, 0, 0, 0)')\r\n    .attr('stroke', '#9a9a9a')\r\n    .attr('stroke-width', 1)\r\n    .attr(\r\n      'd',\r\n      d3\r\n        .line()\r\n        .x(function (d) {\r\n          return xScale(d.index);\r\n        })\r\n        .y(function (d) {\r\n          return yScale(d.value);\r\n        }),\r\n    );\r\n\r\n  if (counterData) {\r\n    innerG\r\n      .append('path')\r\n      .datum(counterData.counts)\r\n      .attr('fill', 'rgba(0, 0, 0, 0)')\r\n      .attr('stroke', 'rgba(18, 81, 153, 1)')\r\n      .attr('stroke-width', 1)\r\n      .attr(\r\n        'd',\r\n        d3\r\n          .line()\r\n          .x(function (d) {\r\n            return xScale(d.index);\r\n          })\r\n          .y(function (d) {\r\n            return yScale(d.value);\r\n          }),\r\n      );\r\n  }\r\n}\r\n","function addTitle(g, width) {\r\n  g.append('text')\r\n    .attr('class', 'graph-title')\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', 15)\r\n    .text('Comptes pendant la journée');\r\n}\r\n\r\nfunction addLabels(g, width, height) {\r\n  // X label\r\n  g.append('g')\r\n    .append('text')\r\n    .attr('class', 'axis-label')\r\n    .text('Heures de la journée')\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', height);\r\n  // Y label\r\n  g.append('g')\r\n    .append('text')\r\n    .attr('class', 'axis-label')\r\n    .text('Comptes')\r\n    .attr('x', 10)\r\n    .attr('y', height / 2)\r\n    .attr('transform', 'rotate(-90)');\r\n}\r\n\r\nfunction generateXScale(width) {\r\n  return d3.scaleLinear().domain([0, 96]).range([0, width]);\r\n}\r\n\r\nfunction generateYScale(height, counts) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain([0, d3.max(counts)])\r\n    .range([height, 0])\r\n    .nice();\r\n}\r\n\r\nfunction addAxes(g, width, height, yScale) {\r\n  // Create X axis with 24 hr time\r\n  const xAxis = d3\r\n    .axisBottom(\r\n      d3\r\n        .scaleTime()\r\n        .range([0, width - 7])\r\n        .nice(),\r\n    )\r\n    .ticks(20)\r\n    .tickFormat(d3.timeFormat('%H:%M'));\r\n\r\n  // Add axes, pixel-perfect positioning\r\n  g.append('g')\r\n    .attr('class', 'axis')\r\n    .attr('transform', 'translate(59,' + height + ')')\r\n    .call(xAxis);\r\n  g.attr('class', 'axis')\r\n    .append('g')\r\n    .attr('transform', 'translate(59,0)')\r\n    .call(d3.axisLeft(yScale));\r\n}\r\n\r\nexport function setupAreaSVG(width, height) {\r\n  const svg = d3\r\n    .select('#area-svg')\r\n    .attr('width', width + 80)\r\n    .attr('height', height + 80);\r\n\r\n  addTitle(svg, width);\r\n}\r\n\r\n/**\r\n * Draws the area chart\r\n *\r\n * @param {object[]} data The data for the map\r\n * @param callback The callback to call on circle click\r\n */\r\nexport function drawAreaChart(width, height, averageData, counterData) {\r\n  const svg = d3.select('#area-svg');\r\n\r\n  // Reset area chart svg\r\n  svg.selectAll('g').remove();\r\n\r\n  // Add labels\r\n  addLabels(svg, width + 80, height + 70, counterData && counterData.name);\r\n\r\n  const outerG = svg\r\n    .append('g')\r\n    .attr('width', width + 30)\r\n    .attr('height', height + 20)\r\n    .attr('transform', 'translate(10, 30)');\r\n\r\n  // Generate scales\r\n  const xScale = generateXScale(width);\r\n  const yScale = generateYScale(height, [\r\n    ...averageData.counts.map((v) => v.value),\r\n    ...(counterData ? counterData.counts.map((v) => v.value) : []),\r\n  ]);\r\n\r\n  // Add title and axes\r\n\r\n  addAxes(outerG, width, height, yScale);\r\n\r\n  const innerG = outerG\r\n    .append('g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .attr('transform', 'translate(60, 0)');\r\n\r\n  // Draw chart\r\n  innerG\r\n    .append('path')\r\n    .datum(averageData.counts)\r\n    .attr('fill', '#c9c9c9')\r\n    .attr('stroke', '#9a9a9a')\r\n    .attr('stroke-width', 1)\r\n    .attr(\r\n      'd',\r\n      d3\r\n        .area()\r\n        .x(function (d) {\r\n          return xScale(d.index);\r\n        })\r\n        .y0(height)\r\n        .y1(function (d) {\r\n          return yScale(d.value);\r\n        }),\r\n    );\r\n\r\n  if (counterData) {\r\n    innerG\r\n      .append('path')\r\n      .datum(counterData.counts)\r\n      .attr('fill', 'rgba(77, 149, 232, 0.5)')\r\n      .attr('stroke', 'rgba(18, 81, 153, 0.5)')\r\n      .attr('stroke-width', 1)\r\n      .attr(\r\n        'd',\r\n        d3\r\n          .area()\r\n          .x(function (d) {\r\n            return xScale(d.index);\r\n          })\r\n          .y0(height)\r\n          .y1(function (d) {\r\n            return yScale(d.value);\r\n          }),\r\n      );\r\n  }\r\n}\r\n\r\nexport function hideAreaChart(width) {\r\n  const svg = d3.select('#area-svg');\r\n\r\n  svg.selectAll('g').remove();\r\n\r\n  svg\r\n    .append('g')\r\n    .append('text')\r\n    .attr('class', 'empty-label')\r\n    .text(\"Cette donnée n'est pas disponible pour l'année choisie.\")\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', 80);\r\n}\r\n","var pointInPolygonFlat = require('./flat.js')\nvar pointInPolygonNested = require('./nested.js')\n\nmodule.exports = function pointInPolygon (point, vs, start, end) {\n    if (vs.length > 0 && Array.isArray(vs[0])) {\n        return pointInPolygonNested(point, vs, start, end);\n    } else {\n        return pointInPolygonFlat(point, vs, start, end);\n    }\n}\nmodule.exports.nested = pointInPolygonNested\nmodule.exports.flat = pointInPolygonFlat\n","// ray-casting algorithm based on\n// https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html\n\nmodule.exports = function pointInPolygonNested (point, vs, start, end) {\n    var x = point[0], y = point[1];\n    var inside = false;\n    if (start === undefined) start = 0;\n    if (end === undefined) end = vs.length;\n    var len = end - start;\n    for (var i = 0, j = len - 1; i < len; j = i++) {\n        var xi = vs[i+start][0], yi = vs[i+start][1];\n        var xj = vs[j+start][0], yj = vs[j+start][1];\n        var intersect = ((yi > y) !== (yj > y))\n            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n        if (intersect) inside = !inside;\n    }\n    return inside;\n};\n","/**\r\n * Appends SVG g elements which will contain the x and y axes.\r\n *\r\n * @param {*} g The d3 Selection of the graph's g SVG element\r\n */\r\n export function appendAxes (g) {\r\n    g.append('g')\r\n      .attr('class', 'x axis')\r\n  \r\n    g.append('g')\r\n      .attr('class', 'y axis')\r\n  }\r\n  \r\n/**\r\n * Appends the labels for the the y axis and the title of the graph.\r\n *\r\n * @param {*} g The d3 Selection of the graph's g SVG element\r\n */\r\n export function appendGraphLabels (g) {\r\n    g.append('text')\r\n      .text('Total counts for the year')\r\n      .attr('class', 'y axis-text')\r\n      .attr('transform', 'rotate(-90)')\r\n      .attr('fill', '#898989')\r\n      .attr('font-size', 12)\r\n  \r\n    g.append('text')\r\n      .text('Average counts per year')\r\n      .attr('class', 'title')\r\n      .attr('fill', '#898989')\r\n  }\r\n\r\n/**\r\n * Sets the size of the SVG canvas containing the graph.\r\n *\r\n * @param {number} width The desired width\r\n * @param {number} height The desired height\r\n */\r\n export function setCanvasSize (width, height) {\r\n    d3.select('#bar-svg')\r\n      .attr('width', width)\r\n      .attr('height', height)\r\n  }\r\n\r\n/**\r\n * Positions the x axis label, y axis label and title label on the graph.\r\n *\r\n * @param {number} width The width of the graph\r\n * @param {number} height The height of the graph\r\n */\r\n export function positionLabels (width, height) {\r\n    d3.select('.y.axis-text')\r\n      .attr('x', -50)\r\n      .attr('y', height / 2)\r\n  \r\n    d3.select('.title')\r\n      .attr('x', width / 2)\r\n      .attr('y', -35)\r\n  }\r\n\r\n/**\r\n * Updates the X scale to be used within each group of the grouped bar chart\r\n *\r\n * @param {*} scale The scale used for the subgroups\r\n * @param {string[]} subGroupBars The bars per subgroup (average on all counters and specific counter)\r\n * @param {*} xScale The graph's encompassing x scale\r\n */\r\n export function updateXSubgroupScale (scale, subGroupBars, xScale) {\r\n    scale\r\n      .domain(subGroupBars)\r\n      .range([0, xScale.bandwidth()])\r\n  }\r\n\r\n/**\r\n * Draws the x axis at the bottom of the plot.\r\n *\r\n * @param {*} xScale The scale to use for the x axis\r\n * @param {number} height The height of the graph\r\n */\r\nexport function drawXAxis (xScale, height) {\r\n    d3.select('.x.axis')\r\n      .attr('transform', 'translate(0, ' + height + ')')\r\n      .call(d3.axisBottom(xScale)\r\n        .tickFormat(x => `year ${x}`))\r\n  }\r\n\r\n/**\r\n * Draws the y axis at the left of the plot.\r\n *\r\n * @param {*} yScale The scale to use for the y axis\r\n */\r\nexport function drawYAxis (yScale) {\r\n    d3.select('.y.axis').call(d3.axisLeft(yScale).ticks(5))\r\n  }\r\n\r\n/**\r\n * Sets the domain and range of the X scale.\r\n *\r\n * @param {*} scale The x scale\r\n * @param {object[]} data The data to be used\r\n * @param {number} width The width of the graph\r\n */\r\n export function updateGroupXScale (scale, data, width) {\r\n    scale.domain(data.Average.year).range([0, width])\r\n  }\r\n  \r\n  /**\r\n   * Sets the domain and range of the Y scale.\r\n   *\r\n   * @param {*} scale The Y scale\r\n   * @param {object[]} data The data to be used\r\n   * @param {number} height The height of the graph\r\n   */\r\n  export function updateYScale (scale, data, height) {\r\n    const max = d3.max(data.Average.counts, m => d3.max(m))\r\n    scale.domain([0, max]).range([height, 0])\r\n  }\r\n  \r\n  /**\r\n   * Creates the groups for the grouped bar chart and appends them to the graph.\r\n   * Each group corresponds to a pair of average/chosen counter values\r\n   *\r\n   * @param {object[]} data The data to be used\r\n   * @param {*} x The graph's x scale\r\n   */\r\n  export function createGroups (data, x) {\r\n    d3.select('#bar-svg')\r\n      .selectAll('.group')\r\n      .data(data)\r\n      .enter()\r\n      .append('g')\r\n      .attr('class', 'group')\r\n      .attr('transform', data => 'translate(' + x(data.Average.year + ',0)'))\r\n      .attr('x', (data) => x(data.Average.year))\r\n  }\r\n  /**\r\n   * Draws the bars inside the groups\r\n   *\r\n   * @param {*} y The graph's y scale\r\n   * @param {*} xSubgroup The x scale to use to position the rectangles in the groups\r\n   * @param {number} height The height of the graph\r\n   * @param {object[]} data The data to be used\r\n   */\r\n  export function drawBars (y, xSubgroup, height, data) {\r\n    d3.select('#bar-svg')\r\n      .selectAll('.group')\r\n      .selectAll('rect')\r\n      .data(data)\r\n      .enter()\r\n      .append('rect')\r\n      .attr('x', (data) => xSubgroup(data.Average.year))\r\n      .attr('y', (data) => y(data.Average.counts))\r\n      .attr('width', xSubgroup.bandwidth())\r\n      .attr('height', (data) => height - y(data.Average.counts))\r\n  }\r\n\r\nconst margin = { top: 80, right: 0, bottom: 80, left: 55 }\r\n\r\nlet bounds\r\nlet svgSize\r\nlet graphSize\r\n\r\nconst xScale = d3.scaleBand().padding(0.15)\r\nconst xSubgroupScale = d3.scaleBand().padding([0.015])\r\nconst yScale = d3.scaleLinear()\r\n\r\n/**\r\n     *   This function handles the graph's sizing.\r\n     */\r\n function setSizing () {\r\n    bounds = d3.select('#bar-svg').node().getBoundingClientRect()\r\n\r\n    svgSize = {\r\n      width: bounds.width,\r\n      height: 550\r\n    }\r\n\r\n    graphSize = {\r\n      width: svgSize.width - margin.right - margin.left,\r\n      height: svgSize.height - margin.bottom - margin.top\r\n    }\r\n\r\n    setCanvasSize(svgSize.width, svgSize.height)\r\n  }\r\n\r\n/**\r\n     *   This function builds the graph.\r\n     */\r\n export function buildBarChart (data, g) {\r\n    appendAxes(g)\r\n    appendGraphLabels(g)\r\n    setSizing()\r\n\r\n    var subGroupBars = ['Average', 'X'] // Update according to data input\r\n\r\n    positionLabels(graphSize.width, graphSize.height)\r\n\r\n    updateGroupXScale(xScale, data, graphSize.width)\r\n    updateXSubgroupScale(xSubgroupScale, subGroupBars, xScale)\r\n    updateYScale(yScale, data, graphSize.height)\r\n\r\n    drawXAxis(xScale, graphSize.height)\r\n    drawYAxis(yScale)\r\n\r\n    createGroups(data, xScale)\r\n    drawBars(yScale, xSubgroupScale, subGroupBars, graphSize.height)\r\n  }","/** Change D3 locale, used in time labels */\r\nexport async function changeLocale() {\r\n  const locale = await d3.json(\r\n    'https://cdn.jsdelivr.net/npm/d3-time-format@3/locale/fr-CA.json',\r\n  );\r\n  locale.shortMonths = locale.shortMonths.map(\r\n    (month) => month.slice(0, 1).toUpperCase() + month.slice(1),\r\n  );\r\n  locale.months = locale.months.map(\r\n    (month) => month.slice(0, 1).toUpperCase() + month.slice(1),\r\n  );\r\n\r\n  d3.timeFormatDefaultLocale(locale);\r\n}\r\n","import 'regenerator-runtime/runtime.js';\r\nimport {\r\n  createBarChartData,\r\n  createLineChartData,\r\n  createDataset,\r\n  getLocationData,\r\n  getCounterData,\r\n  createAreaChartData,\r\n  createMapData,\r\n} from './scripts/preprocess';\r\nimport {\r\n  generateMapGroups,\r\n  drawMapBackground,\r\n  drawBikePaths,\r\n  drawCircles,\r\n} from './scripts/mapViz';\r\nimport { drawDropdown } from './scripts/dropdown.js';\r\nimport {\r\n  dropDownClickHandler,\r\n  circleClickHandler,\r\n} from './scripts/clickHandlers';\r\nimport {\r\n  getMontrealData,\r\n  getProjection,\r\n  getPath,\r\n  getBikePaths,\r\n} from './scripts/geography';\r\nimport { addLineGroup, drawLineChart } from './scripts/lineChart';\r\nimport {\r\n  drawAreaChart,\r\n  hideAreaChart,\r\n  setupAreaSVG,\r\n} from './scripts/areaChart';\r\nimport { buildBarChart } from './scripts/barChartViz.js';\r\nimport { changeLocale } from './scripts/changeLocale';\r\nimport { showViz } from './scripts/spinner';\r\n\r\n(async function () {\r\n  changeLocale();\r\n\r\n  const mapsize = {\r\n    width: 800,\r\n    height: 625,\r\n  };\r\n  const areaSize = {\r\n    width: 800,\r\n    height: 350,\r\n  };\r\n  const lineSize = {\r\n    width: 400,\r\n    height: 250,\r\n  };\r\n\r\n  // Get all raw data\r\n  const years = [\r\n    2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020,\r\n    2021,\r\n  ];\r\n  const montreal = await getMontrealData();\r\n  const bikePaths = await getBikePaths();\r\n  const locationData = await getLocationData();\r\n  const counterData = await getCounterData(years);\r\n\r\n  // Generate SVG groups\r\n  generateMapGroups(mapsize.width, mapsize.height);\r\n  setupAreaSVG(areaSize.width, areaSize.height);\r\n  addLineGroup();\r\n\r\n  // Render map\r\n  const projection = getProjection();\r\n  const path = getPath(projection);\r\n  drawMapBackground(montreal, path);\r\n  drawBikePaths(bikePaths, path);\r\n\r\n  // Get all processed data\r\n  const dataset = createDataset(locationData, counterData, years);\r\n  const mapData = createMapData(dataset, montreal, projection);\r\n  const lineChartData = createLineChartData(dataset, montreal);\r\n  const areaChartData = createAreaChartData(dataset);\r\n  const barChartData = createBarChartData(dataset);\r\n\r\n  // Interactivity and re-drawing\r\n  function redrawVizForCounter(year, counter) {\r\n    drawLineChart(\r\n      lineSize.width,\r\n      lineSize.height,\r\n      lineChartData[year]['Average'],\r\n      lineChartData[year][counter],\r\n    );\r\n    if (year > 2018) {\r\n      drawAreaChart(\r\n        areaSize.width,\r\n        areaSize.height,\r\n        areaChartData[year]['Average'],\r\n        areaChartData[year][counter],\r\n      );\r\n    } else {\r\n      hideAreaChart();\r\n    }\r\n    // buildBarChart(barChartData, '#bar-svg'); WITH COUNTER\r\n  }\r\n  function redrawVizForYear(year) {\r\n    drawCircles(mapData[year], circleClickHandler(redrawVizForCounter));\r\n    drawLineChart(\r\n      lineSize.width,\r\n      lineSize.height,\r\n      lineChartData[year]['Average'],\r\n    );\r\n    if (year > 2018) {\r\n      drawAreaChart(\r\n        areaSize.width,\r\n        areaSize.height,\r\n        areaChartData[year]['Average'],\r\n      );\r\n    } else {\r\n      hideAreaChart(areaSize.width);\r\n    }\r\n    // buildBarChart(barChartData, '#bar-svg'); WITH NO COUNTER\r\n  }\r\n\r\n  const year = drawDropdown(years);\r\n  dropDownClickHandler(redrawVizForYear);\r\n\r\n  // Show viz, hide spinner, draw graphs for first time\r\n  showViz();\r\n  redrawVizForYear(year);\r\n})(d3);\r\n","/** Appends a callback to redraw graphs to the year dropdown\r\n *\r\n * @param callback Redraw function to call on click\r\n */\r\nexport function dropDownClickHandler(callback) {\r\n  d3.select('#dropdown').on('change', () => {\r\n    const year = d3.select('#dropdown').property('value');\r\n    callback(year);\r\n    // Pass year to drawBarChart, drawMapCircles and drawAreaChart to redraw\r\n    // Rerun drawLineChart with no name specified (default data)\r\n  });\r\n}\r\n\r\n/** To be passed to circles to redraw charts on circle click\r\n *\r\n * @param callback Callback to call on click\r\n */\r\nexport function circleClickHandler(callback) {\r\n  return (d) => {\r\n    const year = d3.select('#dropdown').property('value');\r\n    const name = d.name;\r\n    callback(year, name);\r\n    // Pass d.name, d.neighborhood and lineChartData[year][name] to drawLinechart\r\n  };\r\n}\r\n","export function showViz() {\r\n  d3.select('#viz-container').style('visibility', 'visible');\r\n  d3.select('#spinner').style('display', 'none');\r\n}\r\n"],"names":["$5a4e08052c16a16d$exports","point","vs","start","end","x","y","inside","undefined","length","len","i","j","xi","yi","xj","yj","async","$ceabff54d7b213d9$export$ebe55e39390500a5","d3","json","$ceabff54d7b213d9$export$3edc714f9fa271c0","$ceabff54d7b213d9$export$df2567d92aff9d24","lon","lat","montreal","returnName","forEach","feature","$parcel$interopDefault","$44f6d5989509de22$exports","geometry","coordinates","properties","NOM","$ceabff54d7b213d9$export$2aa3fd96c49a84a8","projection","geoPath","$ceabff54d7b213d9$export$c4089d80e25ad81e","longitude","latitude","projected","$5cfb72ae602df450$var$sum","a1","key","map","a","reduce","b","c","isNaN","$5cfb72ae602df450$var$groupSum","key2","$5cfb72ae602df450$export$82208cf1aec14b57","years","counterData","Promise","all","year","csv","$5cfb72ae602df450$export$9d0b2837dcb8a0a9","$5cfb72ae602df450$export$dc0eaef47cc3157f","locations","counters","dataset","acceptedCounters","Object","keys","filter","name","counter","find","t","includes","ID","Nom","Longitude","Latitude","counts","timestep","date","time","entries","value","dateTime","split","count","parseInt","push","$5cfb72ae602df450$export$28eade69d8b9e472","mapData","yearData","neighborhood","$5cfb72ae602df450$export$622bbef83119cb4d","lineChartData","averageDayCounts","newCounts","values","data","v","index","totalCounters","Math","round","$5cfb72ae602df450$export$37f1c0e56374e37c","areaChartData","averageTimeCounts","$5cfb72ae602df450$export$850d506dc089a6ee","barChartData","allCounts","counterSum","average","$1e9b62501dbf7c92$export$48abbfdd2194ed43","path","select","selectAll","enter","append","attr","$1e9b62501dbf7c92$export$62c530ff9ed57277","$1e9b62501dbf7c92$export$e65936cef493d66f","callback","scale","data1","maxCounts","max","scaleLinear","domain","range","$1e9b62501dbf7c92$var$radiusScale","remove","d","on","$d62fe7091d94122e$export$7ab24ddbe2dc5f1a","text","$5549c86fe60bf13a$export$b57f9467d5b39444","width","height","averageData","svg","g","title","$5549c86fe60bf13a$var$addLabels","outerG","xScale","days","$5549c86fe60bf13a$var$generateXScale","yScale","nice","$5549c86fe60bf13a$var$generateYScale","xAxis","axisBottom","scaleTime","Date","ticks","tickFormat","timeFormat","call","axisLeft","$5549c86fe60bf13a$var$addAxes","innerG","datum","line","$244c9d65a2076c81$export$4ef73431a760c0b7","$244c9d65a2076c81$var$addTitle","$244c9d65a2076c81$export$6e6b815fe454364d","$244c9d65a2076c81$var$addLabels","$244c9d65a2076c81$var$generateXScale","$244c9d65a2076c81$var$generateYScale","$244c9d65a2076c81$var$addAxes","area","y0","y1","$244c9d65a2076c81$export$eb93617a76769599","Array","isArray","$4e390afc6e925d05$exports","nested","flat","scaleBand","padding","$41e013a4af9b2007$export$7343075cd7f756c5","locale","shortMonths","month","slice","toUpperCase","months","timeFormatDefaultLocale","mapsize","areaSize","lineSize","bikePaths","locationData","this","parentNode","geoMercator","center","redrawVizForCounter","redrawVizForYear","property","year1","style"],"version":3,"file":"index.3e97f512.js.map"}