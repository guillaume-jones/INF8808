function t(t){return t&&t.__esModule?t.default:t}var e,n;n=function(t,e,n,a){var r=t[0],o=t[1],c=!1;void 0===n&&(n=0),void 0===a&&(a=e.length);for(var i=(a-n)/2,s=0,u=i-1;s<i;u=s++){var d=e[n+2*s+0],l=e[n+2*s+1],p=e[n+2*u+0],f=e[n+2*u+1];l>o!=f>o&&r<(p-d)*(o-l)/(f-l)+d&&(c=!c)}return c};var a;async function r(){return await d3.json("montreal.json")}async function o(){return await d3.json("reseau_cyclable.geojson")}function c(n,a,r){let o="";return r.forEach((r=>{t(e)([n,a],r.geometry.coordinates[0][0])&&(o=r.properties.NOM)})),o}function i(){return d3.geoMercator().center([-73.708879,45.579611]).scale(7e4)}function s(t){return d3.geoPath().projection(t)}function u(t,e,n){const a=n([t,e]);return{x:a[0],y:a[1]}}function d(t,e=""){return e&&(t=t.map((t=>t[e]))),t.reduce(((t,e)=>t+(isNaN(e)?0:e)),0)}function l(t,e,n){return t.reduce(((t,a)=>(t[a[e]]=(t[a[e]]||0)+(isNaN(a[n])?0:a[n]),t)),{})}async function p(t){const e={};return await Promise.all(t.map((async t=>{e[t]=await d3.csv("comptage_velo_"+t+".csv")}))),e}async function f(){return await d3.csv("localisation_des_compteurs_velo.csv")}function g(t,e,n){const a={};return n.forEach((n=>{const r=e[n];a[n]={};const o=Object.keys(r[0]).filter((t=>"Date"!==t&&""!==t));o.forEach((e=>{const r=t.find((t=>e.includes("compteur")?e.includes(t.ID):t.Nom===e));a[n][r.Nom]={name:r.Nom,longitude:r.Longitude,latitude:r.Latitude,counts:[]}})),r.forEach((e=>{let r,c="00:00";Object.entries(e).map((([t,e])=>{if("Date"===t){const t=e.split(" ");r=t[0],t.length>1&&(c=t[1])}return[t,e]})).filter((([t])=>o.includes(t))).forEach((([e,o])=>{parseInt(n)>2018&&(e=t.find((t=>e.includes(t.ID))).Nom),a[n][e].counts.push({date:r,time:c,count:parseInt(o)})}))}))})),a}function h(t,e,n){const a={};return Object.entries(t).forEach((([t,r])=>{a[t]=Object.entries(r).map((([t,a])=>({name:t,neighborhood:c(a.longitude,a.latitude,e),counts:d(a.counts,"count"),...u(a.longitude,a.latitude,n)})))})),a}function m(t,e){const n={};return Object.entries(t).forEach((([t,a])=>{let r;n[t]={},Object.entries(a).forEach((([a,o])=>{let i=[];i=o.counts.length>366?Object.values(l(o.counts,"date","count")):o.counts.map((t=>t.count)),r?i.map(((t,e)=>{r[e]+=t})):r=i,n[t][a]={name:a,neighborhood:c(o.longitude,o.latitude,e),counts:i.map(((t,e)=>({index:e,value:t})))}}));const o=Object.keys(a).length;n[t].Average={name:"All",neighborhood:"",counts:r.map(((t,e)=>({index:e,value:Math.round(t/o)})))}})),n}function v(t){const e={};return Object.entries(t).forEach((([t,n])=>{if(parseInt(t)<2019)return;let a;e[t]={},Object.entries(n).forEach((([n,r])=>{let o=Object.values(l(r.counts,"time","count"));a?o.map(((t,e)=>{a[e]+=t})):a=o,e[t][n]={name:n,counts:o.map(((t,e)=>({index:e,value:t})))}}));const r=Object.keys(n).length;e[t].Average={name:"All",counts:a.map(((t,e)=>({index:e,value:Math.round(t/r)})))}})),e}function x(t){const e={};return Object.entries(t).forEach((([t,n])=>{let a=0;Object.entries(n).forEach((([n,r])=>{const o={year:t,counts:d(r.counts,"count")};a+=o.counts,e[n]?e[n].push(o):e[n]=[o]}));const r={year:t,counts:Math.round(a/Object.keys(n).length)};e.Average?e.Average.push(r):e.Average=[r]})),e}function y(t,e){d3.select("#map-svg").attr("width",t).attr("height",e).append("g").attr("id","map-base-g").attr("width",t).attr("height",e).select((function(){return this.parentNode})).append("g").attr("id","map-lanes-g").attr("width",t).attr("height",e).select((function(){return this.parentNode})).append("g").attr("id","map-circles-g").attr("width",t).attr("height",e)}function b(t,e){d3.select("#map-base-g").selectAll("path").data(t).enter().append("path").attr("d",e).attr("fill","#d8dbe3").attr("stroke","#ffffff").attr("stroke-width",1)}function w(t,e){d3.select("#map-lanes-g").selectAll("path").data(t).enter().append("path").attr("d",e).attr("fill","rgba(0,0,0,0)").attr("stroke","#0bb52d").attr("stroke-width",1.5)}function j(t,e){const n=function(t){const e=d3.max(t.map((t=>t.counts)));return d3.scaleLinear().domain([0,e]).range([4,10])}(t);d3.select("#map-circles-g").selectAll("circle").remove(),d3.select("#map-circles-g").selectAll("circle").data(t).enter().append("circle").attr("class","circle").attr("r",(t=>n(t.counts))).attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("fill","#0461cc").attr("stroke","#ffffff").attr("stroke-width",1).on("click",e)}function k(t,e){return d3.select("#dropdown").attr("transform","translate("+e+", 140)").attr("width",130).attr("height",25).selectAll("myOptions").data(t).enter().append("option").text((function(t){return t})).attr("value",(function(t){return t})),t[0]}function A(t){d3.select("#dropdown").on("change",(()=>{const e=d3.select("#dropdown").property("value");console.log(e),t(e)}))}function O(t){return e=>{const n=d3.select("#dropdown").property("value"),a=e.name;console.log(a),t(n,a)}}function E(t,e,n,a){t.append("g").attr("transform","translate(0,"+n+")").call(d3.axisBottom(function(t){return d3.scaleTime().domain([new Date(2019,12,15,0,0),new Date(2020,11,1,0,0)]).range([0,t]).nice()}(e)).ticks(6)),t.append("g").call(d3.axisLeft(a))}function N(t,e,n,a){d3.select("#line-g").remove();const r=d3.select("#map-svg").append("g").attr("id","line-g").attr("width",t).attr("height",e).attr("transform","translate(40, 0)"),o=function(t,e){return d3.scaleLinear().domain([0,e]).range([0,t])}(t,n.counts.length),c=function(t,e){return d3.scaleLinear().domain([0,d3.max(e)]).range([t,0])}(e,[...n.counts.map((t=>t.value)),...a?a.counts.map((t=>t.value)):[]]);E(r,t,e,c),function(t,e,n,a,r){t.append("text").text("Jours de l'année").attr("x",e/3).attr("y",n+30),t.append("text").text("Comptes").attr("x",10).attr("y",n/2).attr("transform","rotate(-90)"),a?t.append("text").text(a+" - "+r).attr("x",e/4).attr("y",10):t.append("text").text("Moyenne de tous les compteurs").attr("x",e/4).attr("y",10)}(r,t,e,a&&a.name,a&&a.neighborhood),r.append("path").datum(n.counts).attr("fill","rgba(0, 0, 0, 0)").attr("stroke","#9a9a9a").attr("stroke-width",1.5).attr("d",d3.line().x((function(t){return o(t.index)})).y((function(t){return c(t.value)}))),a&&r.append("path").datum(a.counts).attr("fill","rgba(0, 0, 0, 0)").attr("stroke","rgba(18, 81, 153, 1)").attr("stroke-width",1.5).attr("d",d3.line().x((function(t){return o(t.index)})).y((function(t){return c(t.value)})))}function L(t,e,n,a){d3.select("#area-g").remove();const r=d3.select("#area-svg").attr("width",t+40).attr("height",e+20).append("g").attr("id","area-g").attr("width",t).attr("height",e).attr("transform","translate(40, 0)"),o=function(t){return d3.scaleLinear().domain([0,96]).range([0,t])}(t),c=function(t,e){return d3.scaleLinear().domain([0,d3.max(e)]).range([t,0])}(e,[...n.counts.map((t=>t.value)),...a?a.counts.map((t=>t.value)):[]]);r.append("g").attr("transform","translate(0,"+e+")").call(d3.axisBottom(function(t){return d3.scaleTime().domain([new Date(2020,1,1,0,0),new Date(2020,1,2,0,0)]).range([0,t]).nice()}(t))),r.append("g").call(d3.axisLeft(c)),function(t,e,n,a,r){t.append("text").text("Heures de la journée").attr("x",e/3).attr("y",n+20),t.append("text").text("Comptes").attr("x",10).attr("y",n/2).attr("transform","rotate(-90)"),a?t.append("text").text(a+" - "+r).attr("x",e/3).attr("y",10):t.append("text").text("Moyenne de tous les compteurs").attr("x",e/3).attr("y",10)}(r,t,e,a&&a.name,a&&a.neighborhood),r.append("path").datum(n.counts).attr("fill","#c9c9c9").attr("stroke","#9a9a9a").attr("stroke-width",1.5).attr("d",d3.area().x((function(t){return o(t.index)})).y0(e).y1((function(t){return c(t.value)}))),a&&r.append("path").datum(a.counts).attr("fill","rgba(77, 149, 232, 0.5)").attr("stroke","rgba(18, 81, 153, 0.5)").attr("stroke-width",1.5).attr("d",d3.area().x((function(t){return o(t.index)})).y0(e).y1((function(t){return c(t.value)})))}(e=function(t,e,r,o){return e.length>0&&Array.isArray(e[0])?a(t,e,r,o):n(t,e,r,o)}).nested=a=function(t,e,n,a){var r=t[0],o=t[1],c=!1;void 0===n&&(n=0),void 0===a&&(a=e.length);for(var i=a-n,s=0,u=i-1;s<i;u=s++){var d=e[s+n][0],l=e[s+n][1],p=e[u+n][0],f=e[u+n][1];l>o!=f>o&&r<(p-d)*(o-l)/(f-l)+d&&(c=!c)}return c},e.flat=n;d3.scaleBand().padding(.15),d3.scaleBand().padding([.015]),d3.scaleLinear();!async function(t){const e=800,n=625,a=800,c=350,u=400,d=250,l=[2019],E=await r(),D=await o(),M=await f(),_=await p(l);y(e,n);const I=i(),B=s(I);b(E,B),w(D,B);const C=g(M,_,l),P=h(C,E,I),T=m(C,E),H=v(C);x(C);function J(t,e){L(a,c,H[t].Average,H[t][e]),N(u,d,T[t].Average,T[t][e])}function q(t){j(P[t],O(J)),L(a,c,H[t].Average),N(u,d,T[t].Average)}const z=k(l,e);A(q),q(z)}(d3);
//# sourceMappingURL=index.fd9e3d83.js.map
