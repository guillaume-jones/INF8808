function t(t){return t&&t.__esModule?t.default:t}var e,a;a=function(t,e,a,n){var r=t[0],o=t[1],c=!1;void 0===a&&(a=0),void 0===n&&(n=e.length);for(var s=(n-a)/2,i=0,d=s-1;i<s;d=i++){var l=e[a+2*i+0],u=e[a+2*i+1],p=e[a+2*d+0],f=e[a+2*d+1];u>o!=f>o&&r<(p-l)*(o-u)/(f-u)+l&&(c=!c)}return c};var n;async function r(){return await d3.json("montreal.json")}async function o(){return await d3.json("reseau_cyclable.geojson")}function c(a,n,r){let o="";return r.forEach((r=>{t(e)([a,n],r.geometry.coordinates[0][0])&&(o=r.properties.NOM)})),o}function s(){return d3.geoMercator().center([-73.708879,45.579611]).scale(7e4)}function i(t){return d3.geoPath().projection(t)}function d(t,e,a){const n=a([t,e]);return{x:n[0],y:n[1]}}function l(t,e=""){return e&&(t=t.map((t=>t[e]))),t.reduce(((t,e)=>t+(isNaN(e)?0:e)),0)}function u(t,e,a){return t.reduce(((t,n)=>(t[n[e]]=(t[n[e]]||0)+(isNaN(n[a])?0:n[a]),t)),{})}async function p(t){const e={};return await Promise.all(t.map((async t=>{e[t]=await d3.csv("comptage_velo_"+t+".csv")}))),e}async function f(){return await d3.csv("localisation_des_compteurs_velo.csv")}function g(t,e,a){const n={};return a.forEach((a=>{const r=e[a];n[a]={};const o=Object.keys(r[0]).filter((t=>"Date"!==t&&""!==t));o.forEach((e=>{const r=t.find((t=>e.includes("compteur")?e.includes(t.ID):t.Nom===e));n[a][r.Nom]={name:r.Nom,longitude:r.Longitude,latitude:r.Latitude,counts:[]}})),r.forEach((e=>{let r,c="00:00";Object.entries(e).map((([t,e])=>{if("Date"===t){const t=e.split(" ");r=t[0],t.length>1&&(c=t[1])}return[t,e]})).filter((([t])=>o.includes(t))).forEach((([e,o])=>{parseInt(a)>2018&&(e=t.find((t=>e.includes(t.ID))).Nom),n[a][e].counts.push({date:r,time:c,count:parseInt(o)})}))}))})),n}function h(t,e,a){const n={};return Object.entries(t).forEach((([t,r])=>{n[t]=Object.entries(r).map((([t,n])=>({name:t,neighborhood:c(n.longitude,n.latitude,e),counts:l(n.counts,"count"),...d(n.longitude,n.latitude,a)})))})),n}function m(t,e){const a={};return Object.entries(t).forEach((([t,n])=>{let r;a[t]={},Object.entries(n).forEach((([n,o])=>{let s=[];s=o.counts.length>366?Object.values(u(o.counts,"date","count")):o.counts.map((t=>t.count)),r?s.map(((t,e)=>{r[e]+=t})):r=s,a[t][n]={name:n,neighborhood:c(o.longitude,o.latitude,e),counts:s.map(((t,e)=>({index:e,value:t})))}}));const o=Object.keys(n).length;a[t].Average={name:"All",neighborhood:"",counts:r.map(((t,e)=>({index:e,value:Math.round(t/o)})))}})),a}function v(t){const e={};return Object.entries(t).forEach((([t,a])=>{if(parseInt(t)<2019)return;let n;e[t]={},Object.entries(a).forEach((([a,r])=>{let o=Object.values(u(r.counts,"time","count"));n?o.map(((t,e)=>{n[e]+=t})):n=o,e[t][a]={name:a,counts:o.map(((t,e)=>({index:e,value:t})))}}));const r=Object.keys(a).length;e[t].Average={name:"All",counts:n.map(((t,e)=>({index:e,value:Math.round(t/r)})))}})),e}function x(t){const e={};return Object.entries(t).forEach((([t,a])=>{let n=0;Object.entries(a).forEach((([a,r])=>{const o={year:t,counts:l(r.counts,"count")};n+=o.counts,e[a]?e[a].push(o):e[a]=[o]}));const r={year:t,counts:Math.round(n/Object.keys(a).length)};e.Average?e.Average.push(r):e.Average=[r]})),e}function y(t,e){d3.select("#map-svg").attr("width",t).attr("height",e).append("g").attr("id","map-base-g").attr("width",t).attr("height",e).select((function(){return this.parentNode})).append("g").attr("id","map-lanes-g").attr("width",t).attr("height",e).select((function(){return this.parentNode})).append("g").attr("id","map-circles-g").attr("width",t).attr("height",e)}function b(t,e){d3.select("#map-base-g").selectAll("path").data(t).enter().append("path").attr("d",e).attr("fill","#d8dbe3").attr("stroke","#ffffff").attr("stroke-width",1)}function w(t,e){d3.select("#map-lanes-g").selectAll("path").data(t).enter().append("path").attr("d",e).attr("fill","rgba(0,0,0,0)").attr("stroke","#0bb52d").attr("stroke-width",1.5)}function k(t,e){const a=function(t){const e=d3.max(t.map((t=>t.counts)));return d3.scaleLinear().domain([0,e]).range([4,10])}(t);d3.select("#map-circles-g").selectAll("circle").remove(),d3.select("#map-circles-g").selectAll("circle").data(t).enter().append("circle").attr("class","circle").attr("r",(t=>a(t.counts))).attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("fill","#0461cc").attr("stroke","#ffffff").attr("stroke-width",1).on("click",e)}function j(t){return d3.select("#map-div").append("select").attr("id","dropdown").attr("width",130).attr("height",25).selectAll("myOptions").data(t).enter().append("option").text((function(t){return t})).attr("value",(function(t){return t})),t[0]}function A(t){d3.select("#dropdown").on("change",(()=>{const e=d3.select("#dropdown").property("value");console.log(e),t(e)}))}function O(t){return e=>{const a=d3.select("#dropdown").property("value"),n=e.name;console.log(n),t(a,n)}}function E(){d3.select("#map-svg").append("g").attr("id","line-svg")}function N(t,e,a,n){const r=d3.select("#line-svg").attr("width",t+80).attr("height",e+80);r.selectAll("g").remove(),function(t,e,a,n,r){t.append("g").append("text").attr("class","axis-label").text("Jours de l'année").attr("x",e/2+30).attr("y",a),t.append("g").append("text").attr("class","axis-label").text("Comptes").attr("x",10).attr("y",a/2).attr("transform","rotate(-90)");const o=t.append("g").append("text").attr("class","graph-title").attr("x",e/2+30).attr("y",15);n?o.text(n+" - "+r):o.text("Moyenne de tous les compteurs")}(r,t+80,e+70,n&&n.name,n&&n.neighborhood);const o=r.append("g").attr("width",t+30).attr("height",e+20).attr("transform","translate(10, 30)"),c=function(t,e){return d3.scaleLinear().domain([0,e]).range([0,t])}(t,a.counts.length),s=function(t,e){return d3.scaleLinear().domain([0,d3.max(e)]).range([t,0]).nice()}(e,[...a.counts.map((t=>t.value)),...n?n.counts.map((t=>t.value)):[]]);!function(t,e,a,n){const r=d3.axisBottom(d3.scaleTime().domain([new Date(2e3,0,0),new Date(2e3,12,31)]).range([0,e]).nice()).ticks(6).tickFormat(d3.timeFormat("%B"));t.append("g").attr("class","axis").attr("transform","translate(59,"+a+")").call(r),t.attr("class","axis").append("g").attr("transform","translate(59,0)").call(d3.axisLeft(n))}(o,t,e,s);const i=o.append("g").attr("width",t).attr("height",e).attr("transform","translate(60, 0)");i.append("path").datum(a.counts).attr("fill","rgba(0, 0, 0, 0)").attr("stroke","#9a9a9a").attr("stroke-width",1).attr("d",d3.line().x((function(t){return c(t.index)})).y((function(t){return s(t.value)}))),n&&i.append("path").datum(n.counts).attr("fill","rgba(0, 0, 0, 0)").attr("stroke","rgba(18, 81, 153, 1)").attr("stroke-width",1).attr("d",d3.line().x((function(t){return c(t.index)})).y((function(t){return s(t.value)})))}function L(t,e,a,n){const r=d3.select("#area-svg").attr("width",t+80).attr("height",e+80);r.selectAll("g").remove(),function(t,e,a,n){t.append("g").append("text").attr("class","axis-label").text("Heures de la journée").attr("x",e/2+30).attr("y",a),t.append("g").append("text").attr("class","axis-label").text("Comptes").attr("x",10).attr("y",a/2).attr("transform","rotate(-90)");const r=t.append("g").append("text").attr("class","graph-title").attr("x",e/2+30).attr("y",15);n?r.text("Comptes par heure pour "+n):r.text("Moyenne de tous les compteurs")}(r,t+80,e+70,n&&n.name);const o=r.append("g").attr("width",t+30).attr("height",e+20).attr("transform","translate(10, 30)"),c=function(t){return d3.scaleLinear().domain([0,96]).range([0,t])}(t),s=function(t,e){return d3.scaleLinear().domain([0,d3.max(e)]).range([t,0]).nice()}(e,[...a.counts.map((t=>t.value)),...n?n.counts.map((t=>t.value)):[]]);!function(t,e,a,n){const r=d3.axisBottom(d3.scaleTime().range([0,e-7]).nice()).ticks(20).tickFormat(d3.timeFormat("%H:%M"));t.append("g").attr("class","axis").attr("transform","translate(59,"+a+")").call(r),t.attr("class","axis").append("g").attr("transform","translate(59,0)").call(d3.axisLeft(n))}(o,t,e,s);const i=o.append("g").attr("width",t).attr("height",e).attr("transform","translate(60, 0)");i.append("path").datum(a.counts).attr("fill","#c9c9c9").attr("stroke","#9a9a9a").attr("stroke-width",1).attr("d",d3.area().x((function(t){return c(t.index)})).y0(e).y1((function(t){return s(t.value)}))),n&&i.append("path").datum(n.counts).attr("fill","rgba(77, 149, 232, 0.5)").attr("stroke","rgba(18, 81, 153, 0.5)").attr("stroke-width",1).attr("d",d3.area().x((function(t){return c(t.index)})).y0(e).y1((function(t){return s(t.value)})))}(e=function(t,e,r,o){return e.length>0&&Array.isArray(e[0])?n(t,e,r,o):a(t,e,r,o)}).nested=n=function(t,e,a,n){var r=t[0],o=t[1],c=!1;void 0===a&&(a=0),void 0===n&&(n=e.length);for(var s=n-a,i=0,d=s-1;i<s;d=i++){var l=e[i+a][0],u=e[i+a][1],p=e[d+a][0],f=e[d+a][1];u>o!=f>o&&r<(p-l)*(o-u)/(f-u)+l&&(c=!c)}return c},e.flat=a;d3.scaleBand().padding(.15),d3.scaleBand().padding([.015]),d3.scaleLinear();!async function(t){const e=800,a=625,n=800,c=350,d=400,l=250,u=[2019],M=await r(),_=await o(),D=await f(),B=await p(u);y(e,a),E();const I=s(),F=i(I);b(M,F),w(_,F);const C=g(D,B,u),H=h(C,M,I),P=m(C,M),T=v(C);x(C);function J(t,e){L(n,c,T[t].Average,T[t][e]),N(d,l,P[t].Average,P[t][e])}function q(t){k(H[t],O(J)),L(n,c,T[t].Average),N(d,l,P[t].Average)}const z=j(u);A(q),q(z)}(d3);
//# sourceMappingURL=index.6e9bbed2.js.map
