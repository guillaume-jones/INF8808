{"mappings":"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","sources":["node_modules/point-in-polygon/flat.js","src/scripts/geography.js","src/scripts/preprocess.js","src/scripts/mapViz.js","src/scripts/dropdown.js","src/scripts/lineChart.js","src/scripts/areaChart.js","src/scripts/barChartViz.js","src/scripts/changeLocale.js","node_modules/point-in-polygon/index.js","node_modules/point-in-polygon/nested.js","src/index.js","src/scripts/clickHandlers.js","src/scripts/spinner.js"],"sourcesContent":["module.exports = function pointInPolygonFlat (point, vs, start, end) {\n    var x = point[0], y = point[1];\n    var inside = false;\n    if (start === undefined) start = 0;\n    if (end === undefined) end = vs.length;\n    var len = (end-start)/2;\n    for (var i = 0, j = len - 1; i < len; j = i++) {\n        var xi = vs[start+i*2+0], yi = vs[start+i*2+1];\n        var xj = vs[start+j*2+0], yj = vs[start+j*2+1];\n        var intersect = ((yi > y) !== (yj > y))\n            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n        if (intersect) inside = !inside;\n    }\n    return inside;\n};\n","import pointInPolygon from 'point-in-polygon';\r\n\r\n/** Gets the Montreal geographical data\r\n *\r\n * @returns {object[]} Montreal GEOJSON\r\n */\r\nexport async function getMontrealData() {\r\n  return await d3.json('montreal.json');\r\n}\r\n\r\n/** Gets the Montreal geographical data\r\n *\r\n * @returns {object[]} Montreal's bike path GEOJSON\r\n */\r\nexport async function getBikePaths() {\r\n  return await d3.json('reseau_cyclable.geojson');\r\n}\r\n\r\n/**\r\n * Determines the neighborhood based on coordinates\r\n *\r\n * @param lon Longitude of point (float)\r\n * @param lat Latitude of point (float)\r\n * @param montreal Pre-loaded JSON of Montreal data\r\n *\r\n * @returns {string} Neighborhood of point or empty if not found\r\n */\r\nexport function determineNeighborhood(lon, lat, montreal) {\r\n  let returnName = '';\r\n\r\n  montreal.forEach((feature) => {\r\n    if (pointInPolygon([lon, lat], feature.geometry.coordinates[0][0])) {\r\n      returnName = feature.properties.NOM;\r\n    }\r\n  });\r\n\r\n  return returnName;\r\n}\r\n\r\n/** Gets the map projection function\r\n *\r\n * @returns Projection function in Mercator for Montreal\r\n */\r\nexport function getProjection() {\r\n  return d3.geoMercator().center([-73.708879, 45.579611]).scale(70000);\r\n}\r\n\r\n/** Gets the path function\r\n *\r\n * @param projection Projection in Mercator for Montreal\r\n *\r\n * @returns Path function for Montreal\r\n */\r\nexport function getPath(projection) {\r\n  return d3.geoPath().projection(projection);\r\n}\r\n\r\n/** Gets the XY positions on the map viz for a given set of coordinates\r\n * @param {number} longitude Longitude to convert\r\n * @param {number} latitude Latitude to convert\r\n * @param projection Projection in Mercator for Montreal\r\n *\r\n * @returns {x: number, y: number}\r\n */\r\nexport function convertCoordinatesToXY(longitude, latitude, projection) {\r\n  const projected = projection([longitude, latitude]);\r\n  return {\r\n    x: projected[0],\r\n    y: projected[1],\r\n  };\r\n}\r\n","import { convertCoordinatesToXY, determineNeighborhood } from './geography';\r\n\r\nfunction sum(a, key = '') {\r\n  if (key) {\r\n    a = a.map((a) => a[key]);\r\n  }\r\n  return a.reduce((b, c) => b + (isNaN(c) ? 0 : c), 0);\r\n}\r\n\r\nfunction groupSum(a, key, key2) {\r\n  return a.reduce((b, c) => {\r\n    b[c[key]] = (b[c[key]] || 0) + (isNaN(c[key2]) ? 0 : c[key2]);\r\n    return b;\r\n  }, {});\r\n}\r\n\r\n/** Load counter CSVs\r\n *\r\n * @param {number[]} years Array of years to load\r\n *\r\n * @returns {object[]} Array of data by year\r\n */\r\nexport async function getCounterData(years) {\r\n  const counterData = {};\r\n  // Required due to asynchronous loop\r\n  await Promise.all(\r\n    years.map(async (year) => {\r\n      counterData[year] = await d3.csv('comptage_velo_' + year + '.csv');\r\n    }),\r\n  );\r\n\r\n  return counterData;\r\n}\r\n\r\n/** Load location CSV\r\n *\r\n * @returns {object} Location data\r\n */\r\nexport async function getLocationData() {\r\n  return await d3.csv('localisation_des_compteurs_velo.csv');\r\n}\r\n\r\n/** Convert location and counter data into usable dataset\r\n *\r\n * Filters out partial data\r\n * Harmonizes IDs and names\r\n * Organizes by year, counter name, date and time\r\n *\r\n * @param {object} locations Location data from CSV\r\n * @param {object[]} counters Counter data from CSV\r\n * @param {object} years Years of data loaded into counters\r\n *\r\n * @returns {object[]} The filtered and combined dataset\r\n */\r\nexport function createDataset(locations, counters, years) {\r\n  const dataset = {};\r\n\r\n  years.forEach((year) => {\r\n    const counterData = counters[year];\r\n    dataset[year] = {};\r\n\r\n    // Keeps only data columns\r\n    const acceptedCounters = Object.keys(counterData[0]).filter((name) => {\r\n      return name !== 'Date' && name !== '';\r\n    });\r\n\r\n    // Gets relevant data for each counter from location dataset\r\n    acceptedCounters.forEach((name) => {\r\n      const counter = locations.find((t) => {\r\n        if (name.includes('compteur')) {\r\n          // Finds via ID, for 2019-2021 datasets\r\n          return name.includes(t.ID);\r\n        } else {\r\n          // Finds via name, for 2009-2018 datasets\r\n          return t.Nom === name;\r\n        }\r\n      });\r\n\r\n      dataset[year][counter.Nom] = {\r\n        name: counter.Nom,\r\n        longitude: counter.Longitude,\r\n        latitude: counter.Latitude,\r\n        counts: [],\r\n      };\r\n    });\r\n\r\n    // Iterates through counterData to add counts to each counter\r\n    counterData.forEach((timestep) => {\r\n      let date = undefined;\r\n      let time = '00:00';\r\n\r\n      Object.entries(timestep)\r\n        .map(([key, value]) => {\r\n          if (key === 'Date') {\r\n            const dateTime = value.split(' ');\r\n            date = dateTime[0];\r\n            // Gets time as well for datasets after 2018\r\n            if (dateTime.length > 1) {\r\n              time = dateTime[1];\r\n            }\r\n          }\r\n          return [key, value];\r\n        })\r\n        .filter(([name]) => acceptedCounters.includes(name))\r\n        .forEach(([name, count]) => {\r\n          if (parseInt(year) > 2018) {\r\n            name = locations.find((t) => name.includes(t.ID)).Nom;\r\n          }\r\n          dataset[year][name].counts.push({\r\n            date: date,\r\n            time: time,\r\n            count: parseInt(count),\r\n          });\r\n        });\r\n    });\r\n  });\r\n\r\n  return dataset;\r\n}\r\n\r\n/** Generates data in format for map\r\n *\r\n * @param {object} dataset Dataset created by createDataset\r\n * @param montreal Pre-loaded JSON of Montreal data\r\n * @param projection Projection used for the map\r\n *\r\n * @returns {object} Data for Area chart\r\n */\r\nexport function createMapData(dataset, montreal, projection) {\r\n  const mapData = {};\r\n\r\n  Object.entries(dataset).forEach(([year, yearData]) => {\r\n    mapData[year] = Object.entries(yearData).map(([counter, counterData]) => {\r\n      return {\r\n        name: counter,\r\n        neighborhood: determineNeighborhood(\r\n          counterData.longitude,\r\n          counterData.latitude,\r\n          montreal,\r\n        ),\r\n        counts: sum(counterData.counts, 'count'),\r\n        ...convertCoordinatesToXY(\r\n          counterData.longitude,\r\n          counterData.latitude,\r\n          projection,\r\n        ),\r\n      };\r\n    });\r\n  });\r\n\r\n  return mapData;\r\n}\r\n\r\n/** Generates data in format for line chart\r\n *\r\n * @param {object} dataset Dataset created by createDataset\r\n * @param montreal Pre-loaded JSON of Montreal data\r\n */\r\nexport function createLineChartData(dataset, montreal) {\r\n  const lineChartData = {};\r\n\r\n  Object.entries(dataset).forEach(([year, yearData]) => {\r\n    lineChartData[year] = {};\r\n    let averageDayCounts;\r\n\r\n    // Sums counts across each day for each counter\r\n    // Also adds neighborhood\r\n    Object.entries(yearData).forEach(([counter, counterData]) => {\r\n      let newCounts = [];\r\n\r\n      // Years 2019-2021 need to group the data by day\r\n      if (counterData.counts.length > 366) {\r\n        newCounts = Object.values(\r\n          groupSum(counterData.counts, 'date', 'count'),\r\n        );\r\n      } else {\r\n        newCounts = counterData.counts.map((data) => {\r\n          return isNaN(data.count) ? 0 : data.count;\r\n        });\r\n      }\r\n\r\n      // Save this counter's data to averageDayCounts\r\n      if (!averageDayCounts) {\r\n        averageDayCounts = newCounts;\r\n      } else {\r\n        newCounts.map((count, i) => {\r\n          averageDayCounts[i] += count;\r\n        });\r\n      }\r\n\r\n      lineChartData[year][counter] = {\r\n        name: counter,\r\n        neighborhood: determineNeighborhood(\r\n          counterData.longitude,\r\n          counterData.latitude,\r\n          montreal,\r\n        ),\r\n        counts: newCounts.map((v, i) => {\r\n          return {\r\n            index: i,\r\n            value: v,\r\n          };\r\n        }),\r\n      };\r\n    });\r\n\r\n    const totalCounters = Object.keys(yearData).length;\r\n\r\n    lineChartData[year]['Average'] = {\r\n      name: 'All',\r\n      neighborhood: '',\r\n      counts: averageDayCounts.map((counts, i) => {\r\n        return { index: i, value: Math.round(counts / totalCounters) };\r\n      }),\r\n    };\r\n  });\r\n\r\n  return lineChartData;\r\n}\r\n\r\n/** Generates data in format for area chart\r\n *\r\n * @param {object} dataset Dataset created by createDataset\r\n *\r\n * @returns {object} Data for Area chart\r\n */\r\nexport function createAreaChartData(dataset) {\r\n  const areaChartData = {};\r\n\r\n  Object.entries(dataset).forEach(([year, yearData]) => {\r\n    // Time data not available for years before 2019\r\n    if (parseInt(year) < 2019) {\r\n      return;\r\n    }\r\n\r\n    areaChartData[year] = {};\r\n    let averageTimeCounts;\r\n\r\n    // Sums counts across each day for each counter\r\n    // Also adds neighborhood\r\n    Object.entries(yearData).forEach(([counter, counterData]) => {\r\n      let newCounts = Object.values(\r\n        groupSum(counterData.counts, 'time', 'count'),\r\n      );\r\n\r\n      // Save this counter's data to averageTimeCounts\r\n      if (!averageTimeCounts) {\r\n        averageTimeCounts = newCounts;\r\n      } else {\r\n        newCounts.map((count, i) => {\r\n          averageTimeCounts[i] += count;\r\n        });\r\n      }\r\n\r\n      areaChartData[year][counter] = {\r\n        name: counter,\r\n        counts: newCounts.map((v, i) => {\r\n          return {\r\n            index: i,\r\n            value: v,\r\n          };\r\n        }),\r\n      };\r\n    });\r\n\r\n    const totalCounters = Object.keys(yearData).length;\r\n\r\n    areaChartData[year]['Average'] = {\r\n      name: 'All',\r\n      counts: averageTimeCounts.map((counts, i) => {\r\n        return { index: i, value: Math.round(counts / totalCounters) };\r\n      }),\r\n    };\r\n  });\r\n\r\n  return areaChartData;\r\n}\r\n\r\n/** Generates data in format for bar chart\r\n *\r\n * @param {object} dataset Dataset created by createDataset\r\n */\r\nexport function createBarChartData(dataset) {\r\n  const barChartData = {};\r\n\r\n  Object.entries(dataset).forEach(([year, yearData]) => {\r\n    let allCounts = 0;\r\n\r\n    // Sums counts across entire year for each counter\r\n    Object.entries(yearData).forEach(([counter, counterData]) => {\r\n      const counterSum = {\r\n        year: year,\r\n        counts: sum(counterData.counts, 'count'),\r\n      };\r\n\r\n      allCounts += counterSum.counts;\r\n\r\n      barChartData[counter]\r\n        ? barChartData[counter].push(counterSum)\r\n        : (barChartData[counter] = [counterSum]);\r\n    });\r\n\r\n    // Adds average of all sensors for year for default view\r\n    const average = {\r\n      year: year,\r\n      counts: Math.round(allCounts / Object.keys(yearData).length),\r\n    };\r\n\r\n    barChartData['Average']\r\n      ? barChartData['Average'].push(average)\r\n      : (barChartData['Average'] = [average]);\r\n  });\r\n\r\n  return barChartData;\r\n}\r\n","/**\r\n * Adds SVG groups for the map base, bike paths and circles\r\n *\r\n * @param {number} width The width of the graph\r\n * @param {number} height The height of the graph\r\n */\r\nexport function generateMapGroups(width, height) {\r\n  d3.select('#map-svg')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .append('g')\r\n    .attr('id', 'map-base-g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .select(function () {\r\n      return this.parentNode;\r\n    })\r\n    .append('g')\r\n    .attr('id', 'map-lanes-g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .select(function () {\r\n      return this.parentNode;\r\n    })\r\n    .append('g')\r\n    .attr('id', 'map-circles-g')\r\n    .attr('width', width)\r\n    .attr('height', height);\r\n}\r\n\r\n/**\r\n * Generates Gaussian Blur\r\n */\r\nexport function generateBlurMap() {\r\n  const filter = d3\r\n    .select('#map-base-g')\r\n    .append('defs')\r\n    .append('filter')\r\n    .attr('id', 'drop-shadow');\r\n\r\n  filter\r\n    .append('feGaussianBlur')\r\n    .attr('in', 'SourceAlpha')\r\n    .attr('stdDeviation', 1)\r\n    .attr('result', 'blur');\r\n\r\n  filter\r\n    .append('feOffset')\r\n    .attr('in', 'blur')\r\n    .attr('dx', 1)\r\n    .attr('dy', 1)\r\n    .attr('result', 'offsetBlur');\r\n\r\n  const feMerge = filter.append('feMerge');\r\n\r\n  feMerge.append('feMergeNode').attr('in', 'offsetBlur');\r\n  feMerge.append('feMergeNode').attr('in', 'SourceGraphic');\r\n}\r\n\r\n/**\r\n * Draws the map base of Montreal.\r\n *\r\n * @param {object[]} data The data for the map base\r\n * @param {*} path The path associated with the current projection\r\n */\r\nexport function drawMapBackground(data, path) {\r\n  d3.select('#map-base-g')\r\n    .selectAll('path')\r\n    .data(data)\r\n    .enter()\r\n    .append('path')\r\n    .attr('d', path)\r\n    .attr('fill', '#d8dbe3')\r\n    .attr('stroke', '#ffffff')\r\n    .attr('stroke-width', 1);\r\n}\r\n\r\n/**\r\n * Draws the cycle lanes of Montreal\r\n *\r\n * @param {object[]} data The data for the cycle lanes\r\n * @param {*} path The path associated with the current projection\r\n */\r\nexport function drawBikePaths(data, path) {\r\n  d3.select('#map-lanes-g')\r\n    .selectAll('path')\r\n    .data(data)\r\n    .enter()\r\n    .append('path')\r\n    .attr('d', path)\r\n    .attr('fill', 'rgba(0,0,0,0)')\r\n    .attr('stroke', '#0bb52d')\r\n    .attr('stroke-width', 1.5)\r\n    .attr('filter', 'drop-shadow');\r\n}\r\n\r\nfunction radiusScale(data) {\r\n  const maxCounts = d3.max(data.map((data) => data.counts));\r\n  return d3.scaleLinear().domain([0, maxCounts]).range([3, 9]);\r\n}\r\n\r\n/**\r\n * Draws the counter\r\n *\r\n * @param {object[]} data The data for the map\r\n * @param callback The callback to call on circle click\r\n */\r\nexport function drawCircles(data, callback) {\r\n  const scale = radiusScale(data);\r\n\r\n  d3.select('#map-circles-g').selectAll('circle').remove();\r\n\r\n  d3.select('#map-circles-g')\r\n    .selectAll('circle')\r\n    .data(data)\r\n    .enter()\r\n    .append('circle')\r\n    .attr('class', 'circle')\r\n    .attr('r', (d) => scale(d.counts))\r\n    .attr('cx', (d) => d.x)\r\n    .attr('cy', (d) => d.y)\r\n    .attr('fill', 'rgb(18, 81, 153)')\r\n    .attr('stroke', '#ffffff')\r\n    .attr('stroke-width', 1)\r\n    .on('click', callback)\r\n    .on('mouseover', function () {\r\n      d3.select(this)\r\n        .transition(500)\r\n        .ease(d3.easeCubicInOut)\r\n        .attr('r', (d) => scale(d.counts) * 1.5);\r\n    })\r\n    .on('mouseout', function () {\r\n      d3.select(this)\r\n        .transition(500)\r\n        .ease(d3.easeCubicInOut)\r\n        .attr('r', (d) => scale(d.counts));\r\n    });\r\n}\r\n","/**\r\n * Draws the dropdown menu to select the desired year\r\n *\r\n * @param {number} years The years to display\r\n * @param {number} width The width of the graph, used to place the button\r\n *\r\n * @returns Initial year in dropdown\r\n */\r\nexport function drawDropdown(years) {\r\n  d3.select('#dropdown')\r\n    .selectAll('myOptions')\r\n    .data(years)\r\n    .enter()\r\n    .append('option')\r\n    .text(function (d) {\r\n      return d;\r\n    })\r\n    .attr('value', function (d) {\r\n      return d;\r\n    });\r\n\r\n  return years[0];\r\n}\r\n","export function setupLineGroup(width, height) {\r\n  d3.select('#map-svg')\r\n    .append('g')\r\n    .attr('id', 'line-svg')\r\n    .attr('width', width + 80)\r\n    .attr('height', height + 80);\r\n}\r\n\r\n/**\r\n * Generates Gaussian Blur\r\n */\r\nexport function generateBlurLineChart() {\r\n  const filter = d3\r\n    .select('#line-svg')\r\n    .append('defs')\r\n    .append('filter')\r\n    .attr('id', 'drop-shadow');\r\n\r\n  filter\r\n    .append('feGaussianBlur')\r\n    .attr('in', 'SourceAlpha')\r\n    .attr('stdDeviation', 1)\r\n    .attr('result', 'blur');\r\n\r\n  filter\r\n    .append('feOffset')\r\n    .attr('in', 'blur')\r\n    .attr('dx', 1)\r\n    .attr('dy', 1)\r\n    .attr('result', 'offsetBlur');\r\n\r\n  const feMerge = filter.append('feMerge');\r\n\r\n  feMerge.append('feMergeNode').attr('in', 'offsetBlur');\r\n  feMerge.append('feMergeNode').attr('in', 'SourceGraphic');\r\n}\r\n\r\nfunction addLabels(g, width, height, name, neighborhood) {\r\n  // X label\r\n  g.append('g')\r\n    .append('text')\r\n    .attr('class', 'axis-label')\r\n    .text(\"Jours de l'année\")\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', height);\r\n  // Y label\r\n  g.append('g')\r\n    .append('text')\r\n    .attr('class', 'axis-label')\r\n    .text('Comptes')\r\n    .attr('x', 10)\r\n    .attr('y', height / 2)\r\n    .attr('transform', 'rotate(-90)');\r\n  // Title\r\n  const title = g\r\n    .append('g')\r\n    .append('text')\r\n    .attr('class', 'graph-title')\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', 15);\r\n  if (name) {\r\n    title.text(name + ' - ' + neighborhood);\r\n  } else {\r\n    title.text('Moyenne de tous les compteurs');\r\n  }\r\n}\r\n\r\nfunction generateXScale(width, days) {\r\n  return d3.scaleLinear().domain([0, days]).range([0, width]);\r\n}\r\n\r\nfunction generateYScale(height, counts) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain([0, d3.max(counts)])\r\n    .range([height, 0])\r\n    .nice();\r\n}\r\n\r\nfunction addAxes(g, width, height, yScale) {\r\n  // Create X axis with 24 hr time\r\n  const xAxis = d3\r\n    .axisBottom(\r\n      d3\r\n        .scaleTime()\r\n        .domain([new Date(2000, 1, 0), new Date(2000, 12, 1)])\r\n        .range([0, width])\r\n        .nice(),\r\n    )\r\n    .ticks(12)\r\n    .tickFormat(d3.timeFormat('%b'));\r\n\r\n  // Add axes, pixel-perfect positioning\r\n  g.append('g')\r\n    .attr('class', 'axis')\r\n    .attr('transform', 'translate(59,' + height + ')')\r\n    .call(xAxis);\r\n  g.attr('class', 'axis')\r\n    .append('g')\r\n    .attr('transform', 'translate(59,0)')\r\n    .call(d3.axisLeft(yScale));\r\n}\r\n\r\n/**\r\n * Draws the line chart\r\n *\r\n * @param {object[]} data The data for the map\r\n * @param callback The callback to call on circle click\r\n */\r\nexport function drawLineChart(width, height, averageData, counterData) {\r\n  const svg = d3.select('#line-svg');\r\n\r\n  // Reset line chart svg\r\n  svg.selectAll('g').remove();\r\n\r\n  // Add labels\r\n  addLabels(\r\n    svg,\r\n    width + 80,\r\n    height + 70,\r\n    counterData && counterData.name,\r\n    counterData && counterData.neighborhood,\r\n  );\r\n\r\n  const outerG = svg\r\n    .append('g')\r\n    .attr('width', width + 30)\r\n    .attr('height', height + 20)\r\n    .attr('transform', 'translate(10, 30)');\r\n\r\n  // Generate scales\r\n  const xScale = generateXScale(width, averageData.counts.length);\r\n  const yScale = generateYScale(height, [\r\n    ...averageData.counts.map((v) => v.value),\r\n    ...(counterData ? counterData.counts.map((v) => v.value) : []),\r\n  ]);\r\n\r\n  // Add axes\r\n  addAxes(outerG, width, height, yScale);\r\n\r\n  const innerG = outerG\r\n    .append('g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .attr('transform', 'translate(60, 0)');\r\n\r\n  // Draw chart\r\n  innerG\r\n    .append('path')\r\n    .datum(averageData.counts)\r\n    .attr('fill', 'rgba(0, 0, 0, 0)')\r\n    .attr('stroke', '#9a9a9a')\r\n    .attr('stroke-width', 1)\r\n    .attr('filter', 'drop-shadow')\r\n    .attr(\r\n      'd',\r\n      d3\r\n        .line()\r\n        .x(function (d) {\r\n          return xScale(d.index);\r\n        })\r\n        .y(function (d) {\r\n          return yScale(d.value);\r\n        }),\r\n    );\r\n\r\n  if (counterData) {\r\n    innerG\r\n      .append('path')\r\n      .datum(counterData.counts)\r\n      .attr('fill', 'rgba(0, 0, 0, 0)')\r\n      .attr('stroke', 'rgba(18, 81, 153, 1)')\r\n      .attr('stroke-width', 1)\r\n      .attr(\r\n        'd',\r\n        d3\r\n          .line()\r\n          .x(function (d) {\r\n            return xScale(d.index);\r\n          })\r\n          .y(function (d) {\r\n            return yScale(d.value);\r\n          }),\r\n      );\r\n  }\r\n}\r\n","export function setupAreaSVG(width, height) {\r\n  const svg = d3\r\n    .select('#area-svg')\r\n    .attr('width', width + 80)\r\n    .attr('height', height + 80);\r\n\r\n  addTitle(svg, width);\r\n}\r\n\r\nfunction addTitle(g, width) {\r\n  g.append('text')\r\n    .attr('class', 'graph-title')\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', 15)\r\n    .text('Comptes pendant la journée');\r\n}\r\n\r\nfunction addLabels(g, width, height) {\r\n  // X label\r\n  g.append('g')\r\n    .append('text')\r\n    .attr('class', 'axis-label')\r\n    .text('Heures de la journée')\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', height);\r\n  // Y label\r\n  g.append('g')\r\n    .append('text')\r\n    .attr('class', 'axis-label')\r\n    .text('Comptes')\r\n    .attr('x', 10)\r\n    .attr('y', height / 2)\r\n    .attr('transform', 'rotate(-90)');\r\n}\r\n\r\nfunction generateXScale(width) {\r\n  return d3.scaleLinear().domain([0, 96]).range([0, width]);\r\n}\r\n\r\nfunction generateYScale(height, counts) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain([0, d3.max(counts)])\r\n    .range([height, 0])\r\n    .nice();\r\n}\r\n\r\nfunction addAxes(g, width, height, yScale) {\r\n  // Create X axis with 24 hr time\r\n  const xAxis = d3\r\n    .axisBottom(\r\n      d3\r\n        .scaleTime()\r\n        .range([0, width - 7])\r\n        .nice(),\r\n    )\r\n    .ticks(20)\r\n    .tickFormat(d3.timeFormat('%H:%M'));\r\n\r\n  g.append('g')\r\n    .attr('class', 'axis')\r\n    .attr('transform', 'translate(59,' + height + ')')\r\n    .call(xAxis);\r\n  g.attr('class', 'axis')\r\n    .append('g')\r\n    .attr('transform', 'translate(59,0)')\r\n    .call(d3.axisLeft(yScale));\r\n}\r\n\r\n/**\r\n * Generates Gaussian Blur\r\n */\r\nexport function generateBlurAreaChart() {\r\n  const filter = d3\r\n    .select('#area-svg')\r\n    .append('defs')\r\n    .append('filter')\r\n    .attr('id', 'drop-shadow');\r\n\r\n  filter\r\n    .append('feGaussianBlur')\r\n    .attr('in', 'SourceAlpha')\r\n    .attr('stdDeviation', 1)\r\n    .attr('result', 'blur');\r\n\r\n  filter\r\n    .append('feOffset')\r\n    .attr('in', 'blur')\r\n    .attr('dx', 1)\r\n    .attr('dy', 1)\r\n    .attr('result', 'offsetBlur');\r\n\r\n  const feMerge = filter.append('feMerge');\r\n\r\n  feMerge.append('feMergeNode').attr('in', 'offsetBlur');\r\n  feMerge.append('feMergeNode').attr('in', 'SourceGraphic');\r\n}\r\n\r\n/**\r\n * Draws the area chart\r\n *\r\n * @param {object[]} data The data for the map\r\n * @param callback The callback to call on circle click\r\n */\r\nexport function drawAreaChart(width, height, averageData, counterData) {\r\n  const svg = d3.select('#area-svg').attr('height', height + 80);\r\n\r\n  // Reset area chart svg\r\n  svg.selectAll('g').remove();\r\n\r\n  // Add labels\r\n  addLabels(svg, width + 80, height + 70, counterData && counterData.name);\r\n\r\n  const outerG = svg\r\n    .append('g')\r\n    .attr('width', width + 30)\r\n    .attr('height', height + 20)\r\n    .attr('transform', 'translate(10, 30)');\r\n\r\n  // Generate scales\r\n  const xScale = generateXScale(width);\r\n  const yScale = generateYScale(height, [\r\n    ...averageData.counts.map((v) => v.value),\r\n    ...(counterData ? counterData.counts.map((v) => v.value) : []),\r\n  ]);\r\n\r\n  // Add axes\r\n  addAxes(outerG, width, height, yScale);\r\n\r\n  const innerG = outerG\r\n    .append('g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .attr('transform', 'translate(60, 0)');\r\n\r\n  // Draw chart\r\n  innerG\r\n    .append('path')\r\n    .datum(averageData.counts)\r\n    .attr('fill', '#c9c9c9')\r\n    .attr('stroke', '#9a9a9a')\r\n    .attr('stroke-width', 1)\r\n    .attr('filter', 'drop-shadow')\r\n    .attr(\r\n      'd',\r\n      d3\r\n        .area()\r\n        .x(function (d) {\r\n          return xScale(d.index);\r\n        })\r\n        .y0(height)\r\n        .y1(function (d) {\r\n          return yScale(d.value);\r\n        }),\r\n    );\r\n\r\n  if (counterData) {\r\n    innerG\r\n      .append('path')\r\n      .datum(counterData.counts)\r\n      .attr('fill', 'rgba(77, 149, 232, 0.5)')\r\n      .attr('stroke', 'rgba(18, 81, 153, 0.5)')\r\n      .attr('stroke-width', 1)\r\n      .attr(\r\n        'd',\r\n        d3\r\n          .area()\r\n          .x(function (d) {\r\n            return xScale(d.index);\r\n          })\r\n          .y0(height)\r\n          .y1(function (d) {\r\n            return yScale(d.value);\r\n          }),\r\n      );\r\n  }\r\n}\r\n\r\nexport function hideAreaChart(width) {\r\n  const svg = d3.select('#area-svg').attr('height', 130);\r\n\r\n  svg.selectAll('g').remove();\r\n\r\n  svg\r\n    .append('g')\r\n    .append('text')\r\n    .attr('class', 'empty-label')\r\n    .text(\"Cette donnée n'est pas disponible pour l'année choisie.\")\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', 80);\r\n}\r\n","function addTitle(g, width) {\r\n  g.append('text')\r\n    .attr('class', 'graph-title')\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', 15)\r\n    .text(\"Comptes avant et après l'introduction de Bixis électriques\");\r\n}\r\n\r\nfunction addLabels(g, width, height) {\r\n  // X label\r\n  g.append('g')\r\n    .append('text')\r\n    .attr('class', 'axis-label')\r\n    .text('Années')\r\n    .attr('x', width / 2 + 30)\r\n    .attr('y', height);\r\n  // Y label\r\n  g.append('g')\r\n    .append('text')\r\n    .attr('class', 'axis-label')\r\n    .text('Comptes')\r\n    .attr('x', 10)\r\n    .attr('y', height / 2)\r\n    .attr('transform', 'rotate(-90)');\r\n}\r\n\r\nfunction generateXScale(width, years) {\r\n  return d3.scaleBand().padding(0.2).domain(years).range([0, width]);\r\n}\r\n\r\nfunction generateXSubScale(xScale) {\r\n  return d3\r\n    .scaleBand()\r\n    .padding(0.02)\r\n    .domain(['Average', 'Counter'])\r\n    .range([0, xScale.bandwidth()]);\r\n}\r\n\r\nfunction generateYScale(height, counts) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain([0, d3.max(counts)])\r\n    .range([height, 0])\r\n    .nice();\r\n}\r\n\r\nfunction generateColorScale() {\r\n  return d3\r\n    .scaleOrdinal()\r\n    .domain([0, 1, 2, 3])\r\n    .range(['#c9c9c9', '#9a9a9a', 'rgba(77, 149, 232)', 'rgba(18, 81, 153)']);\r\n}\r\n\r\nfunction addAxes(g, height, xScale, yScale) {\r\n  g.append('g')\r\n    .attr('class', 'axis')\r\n    .attr('transform', 'translate(59,' + height + ')')\r\n    .call(d3.axisBottom(xScale));\r\n  g.attr('class', 'axis')\r\n    .append('g')\r\n    .attr('transform', 'translate(59,0)')\r\n    .call(d3.axisLeft(yScale));\r\n}\r\n\r\nexport function setupBarSVG(width, height) {\r\n  const svg = d3\r\n    .select('#bar-svg')\r\n    .attr('width', width + 80)\r\n    .attr('height', height + 80);\r\n\r\n  addTitle(svg, width);\r\n}\r\n\r\nexport function drawBarChart(\r\n  width,\r\n  height,\r\n  bixiYear,\r\n  averageData,\r\n  counterData,\r\n) {\r\n  const svg = d3.select('#bar-svg');\r\n\r\n  // Reset bar chart svg\r\n  svg.selectAll('g').remove();\r\n\r\n  // Add labels\r\n  addLabels(svg, width + 80, height + 70, counterData && counterData.name);\r\n\r\n  const outerG = svg\r\n    .append('g')\r\n    .attr('width', width + 30)\r\n    .attr('height', height + 20)\r\n    .attr('transform', 'translate(10, 30)');\r\n\r\n  // Generate scales\r\n  const xScale = generateXScale(\r\n    width,\r\n    averageData.map((d) => d.year),\r\n  );\r\n  const xSubScale = generateXSubScale(xScale);\r\n  const yScale = generateYScale(height, [\r\n    ...averageData.map((v) => v.counts),\r\n    ...(counterData ? counterData.map((v) => v.counts) : []),\r\n  ]);\r\n  const colorScale = generateColorScale();\r\n\r\n  // Add axes\r\n  addAxes(outerG, height, xScale, yScale);\r\n\r\n  const innerG = outerG\r\n    .append('g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n    .attr('transform', 'translate(60, 0)');\r\n\r\n  // Draw chart\r\n  innerG\r\n    .append('g')\r\n    .attr('id', 'average-bars')\r\n    .selectAll('rect')\r\n    .data(averageData)\r\n    .enter()\r\n    .append('rect')\r\n    .attr('fill', (d) => (d.year < bixiYear ? colorScale(0) : colorScale(1)))\r\n    .attr('x', (d) => xScale(d.year) + xSubScale('Average'))\r\n    .attr('y', (d) => yScale(d.counts))\r\n    .attr('width', xSubScale.bandwidth())\r\n    .attr('height', (d) => height - yScale(d.counts));\r\n\r\n  if (counterData) {\r\n    innerG\r\n      .append('g')\r\n      .attr('id', 'counter-bars')\r\n      .selectAll('rect')\r\n      .data(counterData)\r\n      .enter()\r\n      .append('rect')\r\n      .attr('fill', (d) => (d.year < bixiYear ? colorScale(2) : colorScale(3)))\r\n      .attr('x', (d) => xScale(d.year) + xSubScale('Counter'))\r\n      .attr('y', (d) => yScale(d.counts))\r\n      .attr('width', xSubScale.bandwidth())\r\n      .attr('height', (d) => height - yScale(d.counts));\r\n  }\r\n}\r\n","/** Change D3 locale, used in time labels */\r\nexport async function changeLocale() {\r\n  const locale = await d3.json(\r\n    'https://cdn.jsdelivr.net/npm/d3-time-format@3/locale/fr-CA.json',\r\n  );\r\n  locale.shortMonths = locale.shortMonths.map(\r\n    (month) => month.slice(0, 1).toUpperCase() + month.slice(1),\r\n  );\r\n  locale.months = locale.months.map(\r\n    (month) => month.slice(0, 1).toUpperCase() + month.slice(1),\r\n  );\r\n\r\n  d3.timeFormatDefaultLocale(locale);\r\n}\r\n","var pointInPolygonFlat = require('./flat.js')\nvar pointInPolygonNested = require('./nested.js')\n\nmodule.exports = function pointInPolygon (point, vs, start, end) {\n    if (vs.length > 0 && Array.isArray(vs[0])) {\n        return pointInPolygonNested(point, vs, start, end);\n    } else {\n        return pointInPolygonFlat(point, vs, start, end);\n    }\n}\nmodule.exports.nested = pointInPolygonNested\nmodule.exports.flat = pointInPolygonFlat\n","// ray-casting algorithm based on\n// https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html\n\nmodule.exports = function pointInPolygonNested (point, vs, start, end) {\n    var x = point[0], y = point[1];\n    var inside = false;\n    if (start === undefined) start = 0;\n    if (end === undefined) end = vs.length;\n    var len = end - start;\n    for (var i = 0, j = len - 1; i < len; j = i++) {\n        var xi = vs[i+start][0], yi = vs[i+start][1];\n        var xj = vs[j+start][0], yj = vs[j+start][1];\n        var intersect = ((yi > y) !== (yj > y))\n            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n        if (intersect) inside = !inside;\n    }\n    return inside;\n};\n","import 'regenerator-runtime/runtime.js';\r\nimport {\r\n  createBarChartData,\r\n  createLineChartData,\r\n  createDataset,\r\n  getLocationData,\r\n  getCounterData,\r\n  createAreaChartData,\r\n  createMapData,\r\n} from './scripts/preprocess';\r\nimport {\r\n  generateMapGroups,\r\n  generateBlurMap,\r\n  drawMapBackground,\r\n  drawBikePaths,\r\n  drawCircles,\r\n} from './scripts/mapViz';\r\nimport { drawDropdown } from './scripts/dropdown.js';\r\nimport {\r\n  dropDownClickHandler,\r\n  circleClickHandler,\r\n} from './scripts/clickHandlers';\r\nimport {\r\n  getMontrealData,\r\n  getProjection,\r\n  getPath,\r\n  getBikePaths,\r\n} from './scripts/geography';\r\nimport {\r\n  setupLineGroup,\r\n  drawLineChart,\r\n  generateBlurLineChart,\r\n} from './scripts/lineChart';\r\nimport {\r\n  drawAreaChart,\r\n  hideAreaChart,\r\n  setupAreaSVG,\r\n  generateBlurAreaChart,\r\n} from './scripts/areaChart';\r\nimport { setupBarSVG, drawBarChart } from './scripts/barChartViz.js';\r\nimport { changeLocale } from './scripts/changeLocale';\r\nimport { showViz } from './scripts/spinner';\r\n\r\n(async function () {\r\n  changeLocale();\r\n\r\n  const mapsize = {\r\n    width: 800,\r\n    height: 625,\r\n  };\r\n  const lineSize = {\r\n    width: 400,\r\n    height: 250,\r\n  };\r\n  const areaSize = {\r\n    width: 800,\r\n    height: 350,\r\n  };\r\n  const barSize = areaSize;\r\n\r\n  // Get all raw data\r\n  const years = [\r\n    2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020,\r\n    2021,\r\n  ];\r\n  const bixiYear = 2019;\r\n  const montreal = await getMontrealData();\r\n  const bikePaths = await getBikePaths();\r\n  const locationData = await getLocationData();\r\n  const counterData = await getCounterData(years);\r\n\r\n  // Generate SVG groups\r\n  generateMapGroups(mapsize.width, mapsize.height);\r\n  setupAreaSVG(areaSize.width, areaSize.height);\r\n  setupLineGroup(lineSize.width, lineSize.height);\r\n  setupBarSVG(barSize.width, barSize.height);\r\n\r\n  // Render map\r\n  const projection = getProjection();\r\n  const path = getPath(projection);\r\n  drawMapBackground(montreal, path);\r\n  drawBikePaths(bikePaths, path);\r\n\r\n  // Add Gaussian Blur\r\n  generateBlurMap();\r\n  generateBlurLineChart();\r\n  generateBlurAreaChart();\r\n\r\n  // Get all processed data\r\n  const dataset = createDataset(locationData, counterData, years);\r\n  const mapData = createMapData(dataset, montreal, projection);\r\n  const lineChartData = createLineChartData(dataset, montreal);\r\n  const areaChartData = createAreaChartData(dataset);\r\n  const barChartData = createBarChartData(dataset);\r\n\r\n  // Used to redraw all viz when year changes\r\n  // Reverts to default visualizations\r\n  function redrawVizForYear(year) {\r\n    drawCircles(mapData[year], circleClickHandler(redrawVizForCounter));\r\n    drawLineChart(\r\n      lineSize.width,\r\n      lineSize.height,\r\n      lineChartData[year]['Average'],\r\n    );\r\n    if (year > 2018) {\r\n      drawAreaChart(\r\n        areaSize.width,\r\n        areaSize.height,\r\n        areaChartData[year]['Average'],\r\n      );\r\n    } else {\r\n      hideAreaChart(areaSize.width);\r\n    }\r\n    drawBarChart(\r\n      barSize.width,\r\n      barSize.height,\r\n      bixiYear,\r\n      barChartData['Average'],\r\n    );\r\n  }\r\n  // Used to redraw viz for each counter clicked\r\n  function redrawVizForCounter(year, counter) {\r\n    drawLineChart(\r\n      lineSize.width,\r\n      lineSize.height,\r\n      lineChartData[year]['Average'],\r\n      lineChartData[year][counter],\r\n    );\r\n    if (year > 2018) {\r\n      drawAreaChart(\r\n        areaSize.width,\r\n        areaSize.height,\r\n        areaChartData[year]['Average'],\r\n        areaChartData[year][counter],\r\n      );\r\n    } else {\r\n      hideAreaChart(areaSize.width);\r\n    }\r\n    drawBarChart(\r\n      barSize.width,\r\n      barSize.height,\r\n      bixiYear,\r\n      barChartData['Average'],\r\n      barChartData[counter],\r\n    );\r\n  }\r\n\r\n  const year = drawDropdown(years);\r\n  dropDownClickHandler(redrawVizForYear);\r\n\r\n  // Show viz, hide spinner, draw graphs for first time\r\n  showViz();\r\n  redrawVizForYear(year);\r\n})(d3);\r\n","/** Appends a callback to redraw graphs to the year dropdown\r\n *\r\n * @param callback Redraw function to call on click\r\n */\r\nexport function dropDownClickHandler(callback) {\r\n  d3.select('#dropdown').on('change', () => {\r\n    const year = d3.select('#dropdown').property('value');\r\n    callback(year);\r\n    // Pass year to drawBarChart, drawMapCircles and drawAreaChart to redraw\r\n    // Rerun drawLineChart with no name specified (default data)\r\n  });\r\n}\r\n\r\n/** To be passed to circles to redraw charts on circle click\r\n *\r\n * @param callback Callback to call on click\r\n */\r\nexport function circleClickHandler(callback) {\r\n  return (d) => {\r\n    const year = d3.select('#dropdown').property('value');\r\n    const name = d.name;\r\n    callback(year, name);\r\n    // Pass d.name, d.neighborhood and lineChartData[year][name] to drawLinechart\r\n  };\r\n}\r\n","export function showViz() {\r\n  d3.select('#viz-container').style('visibility', 'visible');\r\n  d3.select('#spinner').style('display', 'none');\r\n}\r\n"],"names":["$5a4e08052c16a16d$exports","point","vs","start","end","x","y","inside","undefined","length","len","i","j","xi","yi","xj","yj","async","$ceabff54d7b213d9$export$ebe55e39390500a5","d3","json","$ceabff54d7b213d9$export$3edc714f9fa271c0","$ceabff54d7b213d9$export$df2567d92aff9d24","lon","lat","montreal","returnName","forEach","feature","$parcel$interopDefault","$44f6d5989509de22$exports","geometry","coordinates","properties","NOM","$ceabff54d7b213d9$export$2aa3fd96c49a84a8","projection","geoPath","$ceabff54d7b213d9$export$c4089d80e25ad81e","longitude","latitude","projected","$5cfb72ae602df450$var$sum","a1","key","map","a","reduce","b","c","isNaN","$5cfb72ae602df450$var$groupSum","key2","$5cfb72ae602df450$export$82208cf1aec14b57","years","counterData","Promise","all","year","csv","$5cfb72ae602df450$export$9d0b2837dcb8a0a9","$5cfb72ae602df450$export$dc0eaef47cc3157f","locations","counters","dataset","acceptedCounters","Object","keys","filter","name","counter","find","t","includes","ID","Nom","Longitude","Latitude","counts","timestep","date","time","entries","value","dateTime","split","count","parseInt","push","$5cfb72ae602df450$export$28eade69d8b9e472","mapData","yearData","neighborhood","$5cfb72ae602df450$export$622bbef83119cb4d","lineChartData","averageDayCounts","newCounts","values","data","v","index","totalCounters","Math","round","$5cfb72ae602df450$export$37f1c0e56374e37c","areaChartData","averageTimeCounts","$5cfb72ae602df450$export$850d506dc089a6ee","barChartData","allCounts","counterSum","average","$1e9b62501dbf7c92$export$72feb4dd7a84b00c","select","append","attr","feMerge","$1e9b62501dbf7c92$export$48abbfdd2194ed43","path","selectAll","enter","$1e9b62501dbf7c92$export$62c530ff9ed57277","$1e9b62501dbf7c92$export$e65936cef493d66f","callback","scale","data1","maxCounts","max","scaleLinear","domain","range","$1e9b62501dbf7c92$var$radiusScale","remove","d","on","this","transition","ease","easeCubicInOut","$d62fe7091d94122e$export$7ab24ddbe2dc5f1a","text","$5549c86fe60bf13a$export$4eeabfdbe5f96d9","width","height","$5549c86fe60bf13a$export$e98d3266212f0020","$5549c86fe60bf13a$export$b57f9467d5b39444","averageData","svg","g","title","$5549c86fe60bf13a$var$addLabels","outerG","xScale","days","$5549c86fe60bf13a$var$generateXScale","yScale","nice","$5549c86fe60bf13a$var$generateYScale","xAxis","axisBottom","scaleTime","Date","ticks","tickFormat","timeFormat","call","axisLeft","$5549c86fe60bf13a$var$addAxes","innerG","datum","line","$244c9d65a2076c81$export$4ef73431a760c0b7","$244c9d65a2076c81$var$addTitle","$244c9d65a2076c81$export$d10f78cca6b9d1ea","$244c9d65a2076c81$export$6e6b815fe454364d","$244c9d65a2076c81$var$addLabels","$244c9d65a2076c81$var$generateXScale","$244c9d65a2076c81$var$generateYScale","$244c9d65a2076c81$var$addAxes","area","y0","y1","$244c9d65a2076c81$export$eb93617a76769599","$88c489d0369beef9$export$25d680cd1394c7f3","$88c489d0369beef9$var$addTitle","$88c489d0369beef9$export$f5a33944a1256dde","bixiYear","$88c489d0369beef9$var$addLabels","scaleBand","padding","$88c489d0369beef9$var$generateXScale","xSubScale","bandwidth","$88c489d0369beef9$var$generateXSubScale","$88c489d0369beef9$var$generateYScale","colorScale","scaleOrdinal","$88c489d0369beef9$var$addAxes","$41e013a4af9b2007$export$7343075cd7f756c5","locale","shortMonths","month","slice","toUpperCase","months","timeFormatDefaultLocale","Array","isArray","$4e390afc6e925d05$exports","nested","flat","mapsize","lineSize","areaSize","barSize","bikePaths","locationData","parentNode","geoMercator","center","redrawVizForYear","redrawVizForCounter","property","year1","style"],"version":3,"file":"index.fc1f5906.js.map"}